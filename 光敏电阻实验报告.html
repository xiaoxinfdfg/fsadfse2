<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光敏电阻实验报告</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        h2 {
            color: #3498db;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"] {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        .chart-container {
            position: relative;
            margin: 20px auto;
            width: 80%;
            height: 400px;
            page-break-inside: avoid;
        }
        .btn {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            resize: vertical;
            page-break-inside: avoid;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .two-columns {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            page-break-inside: avoid;
        }
        .column {
            width: 48%;
        }
        @media (max-width: 768px) {
            .column {
                width: 100%;
            }
        }
        @media print {
            .no-print {
                display: none;
            }
            body {
                padding: 0;
                margin: 0;
            }
            .container {
                box-shadow: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="report-content">
        <h1>光敏电阻实验报告</h1>
        
        <!-- 基本信息 -->
        <div class="section">
            <h2>一、基本信息</h2>
            <table>
                <tr>
                    <td width="15%">专业</td>
                    <td width="35%"><input type="text" id="major"></td>
                    <td width="15%">班级</td>
                    <td width="35%"><input type="text" id="class"></td>
                </tr>
                <tr>
                    <td>学号</td>
                    <td><input type="text" id="student-id"></td>
                    <td>姓名</td>
                    <td><input type="text" id="name"></td>
                </tr>
                <tr>
                    <td>指导教师</td>
                    <td><input type="text" id="instructor" value="马厂"></td>
                    <td>同组人</td>
                    <td><input type="text" id="partner"></td>
                </tr>
                <tr>
                    <td>实验时间</td>
                    <td><input type="text" id="experiment-date"></td>
                    <td>实验地点</td>
                    <td><input type="text" id="experiment-location"></td>
                </tr>
            </table>
        </div>
        
        <!-- 实验目的 -->
        <div class="section">
            <h2>二、实验目的</h2>
            <textarea id="experiment-purpose" placeholder="请填写实验目的..."></textarea>
        </div>
        
        <!-- 实验仪器 -->
        <div class="section">
            <h2>三、实验仪器</h2>
            <textarea id="experiment-equipment" placeholder="请填写实验仪器..."></textarea>
        </div>
        
        <!-- 实验原理 -->
        <div class="section">
            <h2>四、实验原理</h2>
            <p>1.光敏电阻的工作原理</p>
            <p>在光照作用下能使物体的电导率改变的现象称为内光电效应.本实验所用的光敏电阻就是基于内光电效应的光电元件.当内光电效应发生时，固体材料吸收的能量使部分价带电子迁移到导带，同时在价带中留下空穴.这样由于材料中载流子个数，使材料的电导率的改变量为<input type="text" id="principle-blank1" placeholder="请填空" style="width: 300px;">。</p>
            <p>式中ｅ为电荷电量；△ｐ为空穴浓度的改变量；△ｎ为电子浓度的改变量；µｐ为空穴的迁移率；µｎ为电子的迁移率.当光敏电阻两端加上电压Ｕ后，光电流为<input type="text" id="principle-blank2" placeholder="请填空" style="width: 300px;">。</p>
            <p>其中Ａ为与电流垂直的截面积，ｄ为电极间的距离.</p>
            <p>用于制造光敏电阻的材料主要有金属的<input type="text" id="principle-blank3" placeholder="请填空" style="width: 100px;">、<input type="text" id="principle-blank4" placeholder="请填空" style="width: 100px;">和<input type="text" id="principle-blank5" placeholder="请填空" style="width: 100px;">等半导体材料.目前生产的光敏电阻主要是硫化镉.光敏电阻具有灵敏度高、光谱特性好、使用寿命长、稳定性能高、体积小以及制造工艺简单等特点，被广泛地用于自动化技术中.</p>
            <p>本实验光敏电阻得到的光照Φ由一组中性减光片来控制,其透光率有0、25%、50%、75%、100%五档.</p>
            <p>２．光敏电阻的基本特性</p>
            <p>光敏电阻的基本特性包括伏-安特性、光照特性、光电灵敏度、光谱特性、频率特性和温度特性等.本实验主要研究光敏电阻的<input type="text" id="principle-blank6" placeholder="请填空" style="width: 100px;">和<input type="text" id="principle-blank7" placeholder="请填空" style="width: 100px;">。</p>
        </div>
        
        <!-- 实验步骤 -->
        <div class="section">
            <h2>五、实验步骤</h2>
            <p>1．调整光敏电阻和汞灯位于合适位置，转至0的位置，如图1、图2所示，"汞灯电源"通过电缆与"插座"相连，"光敏电阻输入"通过电缆与"插座"相连。</p>
            <p>2．在一定照度下，测量光敏电阻的电压与光电流的关系：将滤光片转至空位，调节中性减光片和光敏电阻测试架的位置使照度表的显示为50LUX左右，调节电压调节旋钮取U值分别为2.00V、3.00V、4.00V、5.00V、6.00V......12.00V,测量光电流的Iph值。</p>
            <p>调节中性减光片和光敏电阻测试架的位置使照度表的显示为100LUX、150 LUX、200 LUX、250LUX、300 LUX左右，重复以上实验，测绘出U－Iph曲线。</p>
            <p>3．在一定工作电压下，测量光敏电阻的照度与光电流的关系。将光敏电阻的工作电压设定为U=2.00V，调节中性减光片和光敏电阻测试架的位置使照度表的显示为100LUX、150 LUX、200 LUX、250LUX、300 LUX左右，测量光电流Iph值。光敏电阻的工作电压分别设定为4V、6V、8V、10V、12V时，重复以上实验，测绘Ф－Iph曲线。</p>
        </div>
        
        <!-- 实验数据记录 -->
        <div class="section">
            <h2>六、实验数据记录</h2>
            <div class="two-columns">
                <div class="column">
                    <h3>1.在一定光照下，测量光敏电阻的电压与电流的关系</h3>
                    <table id="table1">
                        <tr>
                            <th rowspan="2">光照度(LUX)</th>
                            <th colspan="11">电压(V)</th>
                        </tr>
                        <tr>
                            <th>2.00</th>
                            <th>3.00</th>
                            <th>4.00</th>
                            <th>5.00</th>
                            <th>6.00</th>
                            <th>7.00</th>
                            <th>8.00</th>
                            <th>9.00</th>
                            <th>10.00</th>
                            <th>11.00</th>
                            <th>12.00</th>
                        </tr>
                        <tr>
                            <td>50</td>
                            <td><input type="text" class="data-input" data-row="0" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="0" data-col="10"></td>
                        </tr>
                        <tr>
                            <td>100</td>
                            <td><input type="text" class="data-input" data-row="1" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="1" data-col="10"></td>
                        </tr>
                        <tr>
                            <td>150</td>
                            <td><input type="text" class="data-input" data-row="2" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="2" data-col="10"></td>
                        </tr>
                        <tr>
                            <td>200</td>
                            <td><input type="text" class="data-input" data-row="3" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="3" data-col="10"></td>
                        </tr>
                        <tr>
                            <td>250</td>
                            <td><input type="text" class="data-input" data-row="4" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="4" data-col="10"></td>
                        </tr>
                        <tr>
                            <td>300</td>
                            <td><input type="text" class="data-input" data-row="5" data-col="0"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="1"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="2"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="3"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="4"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="5"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="6"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="7"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="8"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="9"></td>
                            <td><input type="text" class="data-input" data-row="5" data-col="10"></td>
                        </tr>
                    </table>
                    <p>注：Iph单位为mA</p>
                </div>
                <div class="column">
                    <h3>2.在一定电压下，测量光敏电阻的照度与电流的关系</h3>
                    <table id="table2">
                        <tr>
                            <th rowspan="2">电压(V)</th>
                            <th colspan="5">光照度(LUX)</th>
                        </tr>
                        <tr>
                            <th>100</th>
                            <th>150</th>
                            <th>200</th>
                            <th>250</th>
                            <th>300</th>
                        </tr>
                        <tr>
                            <td>2.00</td>
                            <td><input type="text" class="data-input2" data-row="0" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="0" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="0" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="0" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="0" data-col="4"></td>
                        </tr>
                        <tr>
                            <td>4.00</td>
                            <td><input type="text" class="data-input2" data-row="1" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="1" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="1" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="1" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="1" data-col="4"></td>
                        </tr>
                        <tr>
                            <td>6.00</td>
                            <td><input type="text" class="data-input2" data-row="2" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="2" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="2" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="2" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="2" data-col="4"></td>
                        </tr>
                        <tr>
                            <td>8.00</td>
                            <td><input type="text" class="data-input2" data-row="3" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="3" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="3" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="3" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="3" data-col="4"></td>
                        </tr>
                        <tr>
                            <td>10.00</td>
                            <td><input type="text" class="data-input2" data-row="4" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="4" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="4" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="4" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="4" data-col="4"></td>
                        </tr>
                        <tr>
                            <td>12.00</td>
                            <td><input type="text" class="data-input2" data-row="5" data-col="0"></td>
                            <td><input type="text" class="data-input2" data-row="5" data-col="1"></td>
                            <td><input type="text" class="data-input2" data-row="5" data-col="2"></td>
                            <td><input type="text" class="data-input2" data-row="5" data-col="3"></td>
                            <td><input type="text" class="data-input2" data-row="5" data-col="4"></td>
                        </tr>
                    </table>
                    <p>注：Iph单位为mA</p>
                </div>
            </div>
        </div>
        
        <!-- 图形绘制 -->
        <div class="section">
            <h2>七、图形绘制</h2>
            <div class="two-columns">
                <div class="column">
                    <h3>1.不同照度下的U-Iph曲线</h3>
                    <div class="chart-container">
                        <canvas id="chart1"></canvas>
                    </div>
                </div>
                <div class="column">
                    <h3>2.不同电压下的Ф-Iph曲线</h3>
                    <div class="chart-container">
                        <canvas id="chart2"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 实验小结 -->
        <div class="section">
            <h2>八、实验小结</h2>
            <textarea id="experiment-summary" placeholder="请填写实验小结..."></textarea>
        </div>
    </div>
    <script>
        // 初始化数据存储
        let experimentData = {
            table1: Array(6).fill().map(() => Array(11).fill('')),
            table2: Array(6).fill().map(() => Array(5).fill(''))
        };
        
        // 监听表格1数据输入
        document.querySelectorAll('#table1 .data-input').forEach(input => {
            input.addEventListener('input', function() {
                const row = parseInt(this.getAttribute('data-row'));
                const col = parseInt(this.getAttribute('data-col'));
                experimentData.table1[row][col] = this.value;
                updateChart1();
            });
        });
        
        // 监听表格2数据输入
        document.querySelectorAll('#table2 .data-input2').forEach(input => {
            input.addEventListener('input', function() {
                const row = parseInt(this.getAttribute('data-row'));
                const col = parseInt(this.getAttribute('data-col'));
                experimentData.table2[row][col] = this.value;
                updateChart2();
            });
        });
        
        // 初始化图表1
        const ctx1 = document.getElementById('chart1').getContext('2d');
        const chart1 = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: ['2.00', '3.00', '4.00', '5.00', '6.00', '7.00', '8.00', '9.00', '10.00', '11.00', '12.00'],
                datasets: [
                    { label: '50 LUX', data: [], borderColor: 'rgba(255, 99, 132, 1)', backgroundColor: 'rgba(255, 99, 132, 0.2)' },
                    { label: '100 LUX', data: [], borderColor: 'rgba(54, 162, 235, 1)', backgroundColor: 'rgba(54, 162, 235, 0.2)' },
                    { label: '150 LUX', data: [], borderColor: 'rgba(255, 206, 86, 1)', backgroundColor: 'rgba(255, 206, 86, 0.2)' },
                    { label: '200 LUX', data: [], borderColor: 'rgba(75, 192, 192, 1)', backgroundColor: 'rgba(75, 192, 192, 0.2)' },
                    { label: '250 LUX', data: [], borderColor: 'rgba(153, 102, 255, 1)', backgroundColor: 'rgba(153, 102, 255, 0.2)' },
                    { label: '300 LUX', data: [], borderColor: 'rgba(255, 159, 64, 1)', backgroundColor: 'rgba(255, 159, 64, 0.2)' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '光电流 Iph (mA)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '电压 U (V)'
                        }
                    }
                }
            }
        });
        
        // 初始化图表2
        const ctx2 = document.getElementById('chart2').getContext('2d');
        const chart2 = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['100', '150', '200', '250', '300'],
                datasets: [
                    { label: '2.00 V', data: [], borderColor: 'rgba(255, 99, 132, 1)', backgroundColor: 'rgba(255, 99, 132, 0.2)' },
                    { label: '4.00 V', data: [], borderColor: 'rgba(54, 162, 235, 1)', backgroundColor: 'rgba(54, 162, 235, 0.2)' },
                    { label: '6.00 V', data: [], borderColor: 'rgba(255, 206, 86, 1)', backgroundColor: 'rgba(255, 206, 86, 0.2)' },
                    { label: '8.00 V', data: [], borderColor: 'rgba(75, 192, 192, 1)', backgroundColor: 'rgba(75, 192, 192, 0.2)' },
                    { label: '10.00 V', data: [], borderColor: 'rgba(153, 102, 255, 1)', backgroundColor: 'rgba(153, 102, 255, 0.2)' },
                    { label: '12.00 V', data: [], borderColor: 'rgba(255, 159, 64, 1)', backgroundColor: 'rgba(255, 159, 64, 0.2)' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '光电流 Iph (mA)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '光照度 Φ (LUX)'
                        }
                    }
                }
            }
        });
        
        // 更新图表1
        function updateChart1() {
            for (let i = 0; i < 6; i++) {
                chart1.data.datasets[i].data = experimentData.table1[i].map(val => parseFloat(val) || 0);
            }
            chart1.update();
        }
        
        // 更新图表2
        function updateChart2() {
            for (let i = 0; i < 6; i++) {
                chart2.data.datasets[i].data = experimentData.table2[i].map(val => parseFloat(val) || 0);
            }
            chart2.update();
        }
        
        // 导出PDF
        document.getElementById('export-pdf').addEventListener('click', async function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            
            // 设置PDF文档属性
            doc.setProperties({
                title: '光敏电阻实验报告',
                subject: '实验报告',
                author: document.getElementById('name').value || '未知',
                keywords: '光敏电阻,实验报告',
                creator: '光敏电阻实验报告系统'
            });
            
            // 临时隐藏输入框，显示纯文本
            const inputs = document.querySelectorAll('input, textarea');
            const originalValues = [];
            inputs.forEach(input => {
                originalValues.push(input.value);
                if (input.type === 'text') {
                    const span = document.createElement('span');
                    span.textContent = input.value || input.placeholder;
                    span.style.whiteSpace = 'nowrap';
                    input.parentNode.insertBefore(span, input);
                    input.style.display = 'none';
                } else if (input.tagName === 'TEXTAREA') {
                    const div = document.createElement('div');
                    div.textContent = input.value || input.placeholder;
                    div.style.whiteSpace = 'pre-wrap';
                    input.parentNode.insertBefore(div, input);
                    input.style.display = 'none';
                }
            });
            
            // 临时替换图表为图像
            const charts = document.querySelectorAll('canvas');
            const chartImages = [];
            
            for (let i = 0; i < charts.length; i++) {
                const chart = charts[i];
                const img = new Image();
                img.src = chart.toDataURL('image/png');
                img.style.width = '100%';
                img.style.height = 'auto';
                chart.parentNode.insertBefore(img, chart);
                chart.style.display = 'none';
                chartImages.push(img);
            }
            
            // 分割内容为多个部分
            const sections = document.querySelectorAll('.section');
            let currentPage = 1;
            let position = 40; // 初始位置
            
            // 添加封面
            doc.setFontSize(24);
            doc.text('光敏电阻实验报告', 297.5, 40, { align: 'center' });
            doc.setFontSize(16);
            doc.text('姓名: ' + (document.getElementById('name').value || '__________'), 297.5, 100, { align: 'center' });
            doc.text('学号: ' + (document.getElementById('student-id').value || '__________'), 297.5, 130, { align: 'center' });
            doc.text('班级: ' + (document.getElementById('class').value || '__________'), 297.5, 160, { align: 'center' });
            doc.text('指导教师: ' + (document.getElementById('instructor').value || '__________'), 297.5, 190, { align: 'center' });
            doc.text('实验日期: ' + (document.getElementById('experiment-date').value || '__________'), 297.5, 220, { align: 'center' });
            
            // 添加页脚
            doc.setFontSize(10);
            doc.text('第 ' + currentPage + ' 页', 297.5, 800, { align: 'center' });
            currentPage++;
            
            // 处理每个部分
            for (let i = 0; i < sections.length; i++) {
                const section = sections[i];
                
                // 使用html2canvas捕获每个部分
                const canvas = await html2canvas(section, {
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollY: 0
                });
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = doc.internal.pageSize.getWidth() - 40;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                // 检查是否需要新页面
                if (position + imgHeight > doc.internal.pageSize.getHeight() - 40) {
                    doc.addPage();
                    position = 40;
                    // 添加页脚
                    doc.setFontSize(10);
                    doc.text('第 ' + currentPage + ' 页', 297.5, 800, { align: 'center' });
                    currentPage++;
                }
                
                doc.addImage(imgData, 'PNG', 20, position, imgWidth, imgHeight);
                position += imgHeight + 20;
            }
            
            // 恢复原始状态
            inputs.forEach((input, index) => {
                if (input.type === 'text' || input.tagName === 'TEXTAREA') {
                    const sibling = input.previousSibling;
                    if (sibling) {
                        input.parentNode.removeChild(sibling);
                    }
                    input.style.display = '';
                    input.value = originalValues[index];
                }
            });
            
            charts.forEach((chart, index) => {
                const img = chartImages[index];
                if (img && img.parentNode) {
                    img.parentNode.removeChild(img);
                }
                chart.style.display = '';
            });
            
            // 保存PDF
            doc.save('光敏电阻实验报告_' + (document.getElementById('name').value || '未知') + '.pdf');
        });
    </script>
</body>
</html>