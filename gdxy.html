<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光电效应实验报告</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 10px;
            margin-top: 30px;
            font-weight: 500;
        }
        h3 {
            color: #3498db;
            margin-top: 25px;
            font-weight: 500;
        }
        .basic-info {
            background: rgba(236, 240, 241, 0.5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(189, 195, 199, 0.2);
        }
        .basic-info table {
            width: 100%;
            border-collapse: collapse;
        }
        .basic-info td {
            padding: 12px;
            border: none;
        }
        .basic-info td:first-child {
            font-weight: 600;
            color: #2c3e50;
            width: 15%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ecf0f1;
        }
        th {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            font-weight: 500;
        }
        tr:nth-child(even) {
            background-color: rgba(236, 240, 241, 0.3);
        }
        tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        .fill-blank {
            border: none;
            border-bottom: 2px solid #3498db;
            background: rgba(52, 152, 219, 0.1);
            padding: 4px 8px;
            text-align: center;
            min-width: 80px;
            font-family: inherit;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .fill-blank:focus {
            outline: none;
            background: rgba(52, 152, 219, 0.2);
            border-bottom: 2px solid #2980b9;
        }
        .data-input {
            width: 70px;
            text-align: center;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            padding: 6px;
            transition: all 0.3s ease;
        }
        .data-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        .formula {
            background: rgba(255, 245, 157, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Cambria Math', 'Times New Roman', serif;
            border-left: 4px solid #f1c40f;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 16px;
            line-height: 1.6;
        }
        .experiment-content {
            background: rgba(200, 230, 201, 0.3);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid rgba(76, 175, 80, 0.1);
        }
        .calculation-section {
            background: rgba(179, 229, 252, 0.3);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid rgba(33, 150, 243, 0.1);
        }
        .score-section {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #4caf50;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .score-btn {
            background: linear-gradient(to bottom, #4caf50, #388e3c);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .score-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .chart-btn {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .chart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .score-display {
            font-size: 24px;
            color: #2e7d32;
            margin: 15px 0;
            font-weight: bold;
        }
        .correct {
            color: #2e7d32 !important;
            border-bottom: 2px solid #4caf50 !important;
            background-color: rgba(76, 175, 80, 0.1) !important;
        }
        .incorrect {
            color: #c62828 !important;
            border-bottom: 2px solid #f44336 !important;
            background-color: rgba(244, 67, 54, 0.1) !important;
        }
        .empty {
            color: #757575 !important;
            border-bottom: 2px dashed #bdbdbd !important;
            background-color: rgba(189, 189, 189, 0.1) !important;
        }
        .info-input {
            border: none;
            border-bottom: 2px solid #3498db;
            background: rgba(52, 152, 219, 0.1);
            padding: 6px 8px;
            text-align: left;
            min-width: 150px;
            font-family: inherit;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .info-input:focus {
            outline: none;
            background: rgba(52, 152, 219, 0.2);
            border-bottom: 2px solid #2980b9;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            width: 100%;
        }
        .summary-box {
            min-height: 150px;
            border: 1px solid rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.6);
            width: 100%;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }
        .comment-section {
            background: rgba(255, 243, 224, 0.7);
            border: 2px solid #ff9800;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .comment-title {
            color: #e65100;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        .comment-content {
            color: #bf360c;
            font-size: 16px;
            line-height: 1.8;
            text-align: justify;
        }
        .auto-grade-btn {
            background: linear-gradient(to bottom, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .auto-grade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .comment-footer {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #ff9800;
            text-align: right;
            font-size: 14px;
            color: #e65100;
            font-weight: 500;
        }
        .section-title {
            background: rgba(52, 152, 219, 0.1);
            padding: 10px 15px;
            border-radius: 6px;
            margin: 20px 0 10px 0;
            font-weight: 600;
            color: #2c3e50;
        }
        .calculation-result {
            font-weight: bold;
            color: #2c3e50;
            padding: 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }
        .question-item {
            margin: 10px 0;
            line-height: 1.6;
        }
        .parameter-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        .param-group {
            display: flex;
            align-items: center;
        }
        .param-label {
            min-width: 100px;
            font-weight: bold;
            color: #4a6fa5;
        }
        .param-input {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        .warning-box {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            color: #e65100;
        }
        .answer-status {
            display: inline-block;
            margin-left: 8px;
            font-size: 16px;
            font-weight: bold;
            vertical-align: middle;
            transition: all 0.3s ease;
        }
        .answer-status.correct-icon {
            color: #4caf50;
        }
        .answer-status.incorrect-icon {
            color: #f44336;
        }
        .answer-status.empty-icon {
            color: #9e9e9e;
        }
        .fill-blank-container {
            position: relative;
            display: inline-block;
        }
        .thought-input {
            width: 100%;
            min-height: 80px;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .thought-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        .thought-answer {
            display: none;
            background: rgba(76, 175, 80, 0.1);
            border-left: 3px solid #4caf50;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 14px;
            color: #2e7d32;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .thought-answer-btn {
            background: linear-gradient(to bottom, #2196f3, #1976d2);
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .thought-answer-btn:hover {
            transform: translateY(-1px);
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        .reference-btn {
            background: linear-gradient(to bottom, #9c27b0, #7b1fa2);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .reference-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        /* 保留原光电效应实验表格样式 */
        .voltage-section {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        .voltage-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 5px;
        }
        .voltage-cell {
            width: 60px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .voltage-cell input {
            width: 100%;
        }
        .voltage-label {
            font-weight: bold;
            width: 100px;
        }
        .equation {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            margin: 15px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 3px;
            text-align: center;
            font-size: 18px;
        }
        .error-calculation {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff3cd;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        .standard-value {
            color: #28a745;
            font-weight: bold;
        }
        .error-value {
            color: #dc3545;
            font-weight: bold;
        }
        
        /* 物理符号样式 */
        sub, sup {
            font-size: 0.75em;
            line-height: 0;
            position: relative;
            vertical-align: baseline;
        }
        sup {
            top: -0.5em;
        }
        sub {
            bottom: -0.25em;
        }
        
        /* 公式分数样式 */
        .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 2px;
        }
        .fraction span {
            display: block;
        }
        .fraction .numerator {
            border-bottom: 1px solid #000;
            padding-bottom: 1px;
        }
        .fraction .denominator {
            padding-top: 1px;
        }
        
        /* 仪器图片样式 */
        .instrument-image {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #ddd;
            transition: transform 0.3s ease;
        }
        
        .instrument-image:hover {
            transform: scale(1.01);
        }
        
        .image-caption {
            text-align: center;
            font-style: italic;
            color: #666;
            margin-top: 8px;
            font-size: 14px;
        }
        
        .instrument-list {
            background: rgba(236, 240, 241, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        @media (max-width: 768px) {
            .parameter-inputs {
                flex-direction: column;
                gap: 10px;
            }
            .btn-group {
                flex-direction: column;
            }
            .score-btn, .chart-btn, .auto-grade-btn, .reference-btn {
                width: 100%;
            }
            .voltage-cell {
                width: 50px;
            }
            .instrument-image {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>光电效应实验报告</h1>
        
        <div class="basic-info">
            <table>
                <tr>
                    <td>实验名称</td>
                    <td><input type="text" class="info-input" placeholder="请输入实验名称" value="光电效应实验"></td>
                    <td>实验时间</td>
                    <td><input type="text" class="info-input" placeholder="请输入实验时间" id="experiment-time"></td>
                </tr>
                <tr>
                    <td>专业</td>
                    <td><input type="text" class="info-input" placeholder="请输入专业" id="major"></td>
                    <td>实验地点</td>
                    <td><input type="text" class="info-input" placeholder="请输入实验地点" id="location"></td>
                </tr>
                <tr>
                    <td>班级</td>
                    <td><input type="text" class="info-input" placeholder="请输入班级" id="class"></td>
                    <td>指导教师</td>
                    <td><input type="text" class="info-input" placeholder="请输入指导教师" id="instructor" value="马厂"></td>
                </tr>
                <tr>
                    <td>学号</td>
                    <td><input type="text" class="info-input" placeholder="请输入学号" id="student-id"></td>
                    <td>同组人</td>
                    <td><input type="text" class="info-input" placeholder="请输入同组人" id="partner"></td>
                </tr>
                <tr>
                    <td>姓名</td>
                    <td><input type="text" class="info-input" placeholder="请输入姓名" id="name"></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>

        <h2>一、实验目的</h2>
        <div class="question-item">
            1. 了解光电效应的规律，加深对光的<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="量子性" placeholder="请填写" id="purpose1"><span class="answer-status"></span></span>的认识。
        </div>
        <div class="question-item">
            2. 测量<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="普朗克常数" placeholder="请填写" id="purpose2"><span class="answer-status"></span></span>。
        </div>

        <h2>二、实验仪器</h2>
        <div class="question-item">
            光电效应实验仪主要由以下部件组成：
        </div>
        
        <!-- 插入仪器图片 -->
        <div style="text-align: center; margin: 20px 0;">
            <img src="https://xiaoxinfdfg.github.io/fsadfse2/gdxytu1.png" 
                 alt="光电效应实验仪器结构图" 
                 class="instrument-image"
                 onerror="this.src='https://via.placeholder.com/800x400?text=光电效应实验仪器结构图+（图片加载失败）'">
            <div class="image-caption">图1：光电效应实验仪器结构示意图</div>
        </div>
        
        <div class="instrument-list">
            <div class="question-item">
                查看实验指导书，根据仪器结构图填空：
            </div>
            <div class="question-item">
                1. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="汞灯电源" placeholder="请填写" id="instrument1"><span class="answer-status"></span></span>；
            </div>
            <div class="question-item">
                2. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="汞灯" placeholder="请填写" id="instrument2"><span class="answer-status"></span></span>；
            </div>
            <div class="question-item">
                3. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="滤色片" placeholder="请填写" id="instrument3"><span class="answer-status"></span></span>；
            </div>
            <div class="question-item">
                4. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="光阑" placeholder="请填写" id="instrument4"><span class="answer-status"></span></span>；
            </div>
            <div class="question-item">
                5. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="光电管" placeholder="请填写" id="instrument5"><span class="answer-status"></span></span>；
            </div>
            <div class="question-item">
                6. <span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="基座" placeholder="请填写" id="instrument6"><span class="answer-status"></span></span>。
            </div>
        </div>

        <h2>三、实验原理</h2>
        <div class="question-item">
            入射光照射到光电管阴极K上，产生的光电子在电场的作用下向阳极A迁移构成光电流，改变外加电压U<sub>AK</sub>，测量出光电流I的大小，即可得出光电管的伏安特性曲线。光电效应的基本实验事实如下：
        </div>
        <div class="question-item">
            (1) 对应于某一频率，光电效应的I-U<sub>AK</sub>关系如图2所示。从图中可见，对一定的频率，有一电压U<sub>0</sub>，当U<sub>AK</sub> ≤ U<sub>0</sub>时，电流为零，这个相对于阴极的负值的阳极电压U<sub>0</sub>，被称为<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="截止电压" placeholder="请填写" id="theory1"><span class="answer-status"></span></span>。
        </div>
        <div class="question-item">
            (2) 当U<sub>AK</sub> ≥ U<sub>0</sub>后，I迅速增加，然后趋于饱和，饱和光电流I<sub>M</sub>的大小与<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="入射光的强度" placeholder="请填写" id="theory2"><span class="answer-status"></span></span>成正比。
        </div>
        <div class="question-item">
            (4) 截止电压U<sub>0</sub>与频率ν的关系如图4所示，U<sub>0</sub>与ν成<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="正比" placeholder="请填写" id="theory3"><span class="answer-status"></span></span>。当入射光频率<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="小于" placeholder="请填写" id="theory4"><span class="answer-status"></span></span>某极限值ν<sub>0</sub>（ν<sub>0</sub>随不同金属而异）时，不论光的强度如何，照射时间多长，都没有光电流产生。
        </div>
        <div class="question-item">
            (5) 光电效应是<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="瞬时" placeholder="请填写" id="theory5"><span class="answer-status"></span></span>效应。即使入射光的强度非常微弱，只要频率<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="高于" placeholder="请填写" id="theory6"><span class="answer-status"></span></span>ν<sub>0</sub>，在开始照射后立即有光电子产生，所经过的时间至多为10<sup>-9</sup>秒的数量级。
        </div>
        
        <div class="formula">
            <p><strong>爱因斯坦光电效应方程：</strong></p>
            <p>hν = A + <span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup></p>
            <p>式中，A为金属的<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="逸出功" placeholder="请填写" id="theory7"><span class="answer-status"></span></span>，<span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup>为光电子获得的<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="初始动能" placeholder="请填写" id="theory8"><span class="answer-status"></span></span>。</p>
        </div>
        
        <div class="formula">
            <p><strong>截止电压与频率的关系：</strong></p>
            <p>eU<sub>0</sub> = <span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup> = hν - A</p>
        </div>
        
        <div class="formula">
            <p><strong>线性关系：</strong></p>
            <p>U<sub>0</sub> = <span class="fraction"><span class="numerator">h</span><span class="denominator">e</span></span>ν - <span class="fraction"><span class="numerator">A</span><span class="denominator">e</span></span></p>
            <p>此式表明截止电压U<sub>0</sub>是频率ν的线性函数，直线斜率k = h/e，只要用实验方法得出不同的频率对应的截止电压，求出直线斜率，就可算出普朗克常数h。</p>
        </div>

        <h2>四、实验步骤</h2>
        <div class="experiment-content">
            <div class="question-item">
                1、测试前准备：将实验仪及汞灯电源接通（盖上汞灯遮光盖，将光电管暗盒通光孔转到遮光位置），预热<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="20" placeholder="请填写" id="procedure1"><span class="answer-status"></span></span>min。
            </div>
            <div class="question-item">
                2、调整光电管与汞灯距离为约<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="20" placeholder="请填写" id="procedure2"><span class="answer-status"></span></span>cm并保持不变。
            </div>
            <div class="question-item">
                3、打开汞灯遮光盖，将光阑旋转到直径4mm的位置，将滤色片旋转到<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="365" placeholder="请填写" id="procedure3"><span class="answer-status"></span></span>nm的位置。
            </div>
            <div class="question-item">
                4、从0.00V开始，减少电压（向-3.00V），开始观察电流值的变化，寻找电流为零时对应的U<sub>AK</sub>，以其绝对值作为该波长对应的U<sub>0</sub>的值。
            </div>
            <div class="question-item">
                5、依次旋转选择577nm，546.1nm，436nm，405nm，365nm的滤色片，重复以上测量步骤。
            </div>
            <div class="question-item">
                6、测光电管的伏安特性曲线：将光阑旋转到直径4mm的位置，将滤色片旋转到365nm的位置，距离<span class="fill-blank-container"><input type="text" class="fill-blank" data-answer="40" placeholder="请填写" id="procedure4"><span class="answer-status"></span></span>cm。伏安特性曲线测量的最大范围为-2V～50V。测量时每隔0.5V或1V记录。
            </div>
        </div>

        <h2>五、实验数据记录</h2>
        <div class="warning-box">
            ⚠️ 警告：以下表格数据需根据实际实验测量填写！若直接搬用参考数据，数据部分将计0分！
            <div style="margin-top: 10px;">
                <button class="reference-btn" onclick="fillReferenceData()">填入参考数据（仅供对照）</button>
            </div>
        </div>
        
        <div class="calculation-section">
            <div class="section-title">表1：U<sub>0</sub> — ν 关系 光阑孔 Φ = 4 mm</div>
            <table>
                <thead>
                    <tr>
                        <th>波长 λ<sub>i</sub> (nm)</th>
                        <th>365</th>
                        <th>404.7</th>
                        <th>435.8</th>
                        <th>546.1</th>
                        <th>577</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>频率 ν<sub>i</sub> (×10¹⁴ Hz)</td>
                        <td>8.214</td>
                        <td>7.408</td>
                        <td>6.879</td>
                        <td>5.49</td>
                        <td>5.196</td>
                    </tr>
                    <tr>
                        <td>截止电压 U<sub>0i</sub>（V）</td>
                        <td><input type="text" class="data-input u0-data" id="u0-1" value="" step="0.01" placeholder="输入数据"></td>
                        <td><input type="text" class="data-input u0-data" id="u0-2" value="" step="0.01" placeholder="输入数据"></td>
                        <td><input type="text" class="data-input u0-data" id="u0-3" value="" step="0.01" placeholder="输入数据"></td>
                        <td><input type="text" class="data-input u0-data" id="u0-4" value="" step="0.01" placeholder="输入数据"></td>
                        <td><input type="text" class="data-input u0-data" id="u0-5" value="" step="0.01" placeholder="输入数据"></td>
                    </tr>
                </tbody>
            </table>

            <div class="section-title">表2：I — U<sub>AK</sub> 关系 光阑孔 Φ = 4 mm, 滤色片 365nm</div>
            <div class="voltage-section">
                <h4>电压 U<sub>AK</sub> / V 从 -2V 到 50V</h4>
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">-2</div>
                    <div class="voltage-cell">-1</div>
                    <div class="voltage-cell">0</div>
                    <div class="voltage-cell">1</div>
                    <div class="voltage-cell">2</div>
                    <div class="voltage-cell">3</div>
                    <div class="voltage-cell">4</div>
                    <div class="voltage-cell">5</div>
                    <div class="voltage-cell">6</div>
                    <div class="voltage-cell">7</div>
                    <div class="voltage-cell">8</div>
                    <div class="voltage-cell">9</div>
                    <div class="voltage-cell">10</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">11</div>
                    <div class="voltage-cell">12</div>
                    <div class="voltage-cell">13</div>
                    <div class="voltage-cell">14</div>
                    <div class="voltage-cell">15</div>
                    <div class="voltage-cell">16</div>
                    <div class="voltage-cell">17</div>
                    <div class="voltage-cell">18</div>
                    <div class="voltage-cell">19</div>
                    <div class="voltage-cell">20</div>
                    <div class="voltage-cell">21</div>
                    <div class="voltage-cell">22</div>
                    <div class="voltage-cell">23</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">24</div>
                    <div class="voltage-cell">25</div>
                    <div class="voltage-cell">26</div>
                    <div class="voltage-cell">27</div>
                    <div class="voltage-cell">28</div>
                    <div class="voltage-cell">29</div>
                    <div class="voltage-cell">30</div>
                    <div class="voltage-cell">31</div>
                    <div class="voltage-cell">32</div>
                    <div class="voltage-cell">33</div>
                    <div class="voltage-cell">34</div>
                    <div class="voltage-cell">35</div>
                    <div class="voltage-cell">36</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">37</div>
                    <div class="voltage-cell">38</div>
                    <div class="voltage-cell">39</div>
                    <div class="voltage-cell">40</div>
                    <div class="voltage-cell">41</div>
                    <div class="voltage-cell">42</div>
                    <div class="voltage-cell">43</div>
                    <div class="voltage-cell">44</div>
                    <div class="voltage-cell">45</div>
                    <div class="voltage-cell">46</div>
                    <div class="voltage-cell">47</div>
                    <div class="voltage-cell">48</div>
                    <div class="voltage-cell">49</div>
                    <div class="voltage-cell">50</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i365-data" placeholder="输入"></div>
                </div>
            </div>

            <div class="section-title">表3：I — U<sub>AK</sub> 关系 光阑孔 Φ = 4 mm, 滤色片 405nm</div>
            <div class="voltage-section">
                <h4>电压 U<sub>AK</sub> / V 从 -2V 到 50V</h4>
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">-2</div>
                    <div class="voltage-cell">-1</div>
                    <div class="voltage-cell">0</div>
                    <div class="voltage-cell">1</div>
                    <div class="voltage-cell">2</div>
                    <div class="voltage-cell">3</div>
                    <div class="voltage-cell">4</div>
                    <div class="voltage-cell">5</div>
                    <div class="voltage-cell">6</div>
                    <div class="voltage-cell">7</div>
                    <div class="voltage-cell">8</div>
                    <div class="voltage-cell">9</div>
                    <div class="voltage-cell">10</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">11</div>
                    <div class="voltage-cell">12</div>
                    <div class="voltage-cell">13</div>
                    <div class="voltage-cell">14</div>
                    <div class="voltage-cell">15</div>
                    <div class="voltage-cell">16</div>
                    <div class="voltage-cell">17</div>
                    <div class="voltage-cell">18</div>
                    <div class="voltage-cell">19</div>
                    <div class="voltage-cell">20</div>
                    <div class="voltage-cell">21</div>
                    <div class="voltage-cell">22</div>
                    <div class="voltage-cell">23</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">24</div>
                    <div class="voltage-cell">25</div>
                    <div class="voltage-cell">26</div>
                    <div class="voltage-cell">27</div>
                    <div class="voltage-cell">28</div>
                    <div class="voltage-cell">29</div>
                    <div class="voltage-cell">30</div>
                    <div class="voltage-cell">31</div>
                    <div class="voltage-cell">32</div>
                    <div class="voltage-cell">33</div>
                    <div class="voltage-cell">34</div>
                    <div class="voltage-cell">35</div>
                    <div class="voltage-cell">36</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">37</div>
                    <div class="voltage-cell">38</div>
                    <div class="voltage-cell">39</div>
                    <div class="voltage-cell">40</div>
                    <div class="voltage-cell">41</div>
                    <div class="voltage-cell">42</div>
                    <div class="voltage-cell">43</div>
                    <div class="voltage-cell">44</div>
                    <div class="voltage-cell">45</div>
                    <div class="voltage-cell">46</div>
                    <div class="voltage-cell">47</div>
                    <div class="voltage-cell">48</div>
                    <div class="voltage-cell">49</div>
                    <div class="voltage-cell">50</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="data-input i405-data" placeholder="输入"></div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="chart-btn" onclick="calculateData()">计算普朗克常数</button>
            </div>
        </div>

        <h2>六、图表分析</h2>
        <div class="section" style="margin-top: 30px; padding: 20px; background-color: #f9fafc; border-radius: 8px; border-left: 4px solid #4a6fa5;">
            <div class="chart-container">
                <canvas id="u0Chart"></canvas>
            </div>
            
            <div class="calculation-result" style="width: 100%; margin-top: 20px; padding: 15px; background-color: #f0f8ff; border-radius: 5px; border-left: 4px solid #4CAF50;">
                <p>斜率 k = <span id="slopeValue">0</span> V·s</p>
                <p>普朗克常数 h = <span id="planckConstant">0</span> J·s</p>
                <p>线性拟合方程: <span id="equation">y = kx + b</span></p>
                
                <div class="error-calculation">
                    <h4>误差分析</h4>
                    <p>普朗克常数标准值: <span class="standard-value">6.62607015×10⁻³⁴ J·s</span></p>
                    <p>绝对误差 Δh = <span id="absoluteError">0</span> J·s</p>
                    <p>相对误差 E = <span id="relativeError">0</span> %</p>
                    <p>线性相关系数 R² = <span id="correlationCoefficient">0</span></p>
                </div>
            </div>
            
            <div class="chart-container" style="margin-top: 40px;">
                <canvas id="iUChart"></canvas>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="chart-btn" onclick="drawCharts()">绘制图表</button>
                <button class="reference-btn" onclick="fillReferenceData()">填入参考数据</button>
            </div>
        </div>

        <h2>七、思考题</h2>
        <div class="question-item">
            1．什么是光电效应？光电效应的主要特征是什么？
            <textarea class="thought-input" placeholder="请简要回答"></textarea>
            <button class="thought-answer-btn" onclick="toggleAnswer(1)">显示参考答案</button>
            <div id="answer1" class="thought-answer">
                答：光电效应是指当光照射到金属表面时，金属中的电子吸收光子能量而逸出金属表面的现象。主要特征：1)存在截止频率（红限频率）；2)光电子的最大初动能与入射光频率成正比，与光强无关；3)光电流强度与入射光强度成正比；4)光电效应具有瞬时性。
            </div>
        </div>
        <div class="question-item">
            2．截止电压U<sub>0</sub>与入射光频率ν的关系是什么？如何通过这种关系测定普朗克常数h？
            <textarea class="thought-input" placeholder="请简要回答"></textarea>
            <button class="thought-answer-btn" onclick="toggleAnswer(2)">显示参考答案</button>
            <div id="answer2" class="thought-answer">
                答：截止电压U<sub>0</sub>与入射光频率ν成线性关系：U<sub>0</sub> = (h/e)ν - A/e。通过测量不同频率下的截止电压，作U<sub>0</sub>-ν图，得到一条直线，其斜率k = h/e，由此可计算出普朗克常数h = k·e，其中e为电子电荷。
            </div>
        </div>
        <div class="question-item">
            3．为什么说光电效应实验验证了光的粒子性？
            <textarea class="thought-input" placeholder="请简要回答"></textarea>
            <button class="thought-answer-btn" onclick="toggleAnswer(3)">显示参考答案</button>
            <div id="answer3" class="thought-answer">
                答：光电效应的许多特征无法用经典波动理论解释：1)按照波动理论，光强越大，电子获得的能量越多，但实验表明光电子的最大初动能与光强无关；2)波动理论无法解释截止频率的存在；3)波动理论认为能量积累需要时间，但光电效应是瞬时的。爱因斯坦的光量子假说认为光是由一份份光子组成的，每个光子能量E=hν，成功解释了光电效应，从而验证了光的粒子性。
            </div>
        </div>

        <h2>八、实验小结</h2>
        <textarea class="summary-box" id="summary" placeholder="请输入实验小结（包括实验目的、步骤、结果分析、心得体会等）..."></textarea>

        <h2>九、计算预习分数</h2>
        <div class="score-section">
            <p>请填写所有填空题后，点击计算分数</p>
            <button class="score-btn" onclick="calculatePreScore()">计算预习分数</button>
            <div class="score-display" id="scoreDisplay"></div>
        </div>

        <h2>十、自动评分并生成评语</h2>
        <div class="comment-section" id="commentSection">
            <div class="comment-title">实验评语</div>
            <div class="comment-content" id="commentContent">
                <p style="text-align: center; color: #999;">点击"自动评分并生成评语"按钮生成实验评语和报告得分</p>
            </div>
            <div class="comment-footer" id="commentFooter" style="display: none;">
                <div>指导教师：<span id="teacherName"></span></div>
                <div>评语日期：<span id="currentDate"></span></div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="auto-grade-btn" onclick="autoGrade()">自动评分并生成评语</button>
            </div>
        </div>
    </div>

    <script>
        // 答案定义（允许多个正确答案）
        const answers = {
            purpose1: ["量子性"],
            purpose2: ["普朗克常量", "普朗克常数", "普朗克常量h"],
            instrument1: ["汞灯电源"],
            instrument2: ["汞灯"],
            instrument3: ["滤色片"],
            instrument4: ["光阑"],
            instrument5: ["光电管"],
            instrument6: ["基座"],
            theory1: ["截止电压"],
            theory2: ["入射光的强度", "入射光强度"],
            theory3: ["正比"],
            theory4: ["小于", "低于"],
            theory5: ["瞬时"],
            theory6: ["高于", "大于"],
            theory7: ["逸出功"],
            theory8: ["初始动能"],
            procedure1: ["20"],
            procedure2: ["20"],
            procedure3: ["365.0", "365"],
            procedure4: ["40"]
        };

        // 参考数据
        const referenceData = {
            u0: ["1.63", "1.20", "0.98", "0.64", "0.41"],
            i365: [
                "-0.1", "0.16", "0.47", "1.11", "1.70", "2.41", "3.24", "3.90", "4.52", "5.12", "5.70", "6.27", "6.81",
                "7.29", "7.73", "8.24", "8.62", "8.93", "9.29", "9.59", "9.88", "10.24", "10.47", "10.70", "11", "11.4",
                "11.62", "11.85", "12.06", "12.26", "12.46", "12.65", "12.80", "12.97", "13.16", "13.30", "13.45", "13.59", "13.70",
                "13.82", "13.92", "14.13", "14.21", "14.28", "14.40", "14.50", "14.55", "14.60", "14.70", "14.78", "14.89", "15.00", "15.05"
            ],
            i405: [
                "0", "0.04", "0.21", "0.42", "0.70", "0.98", "1.25", "1.47", "1.68", "1.88", "2.05", "2.25", "2.43",
                "2.59", "2.76", "2.92", "3.02", "3.13", "3.24", "3.31", "3.45", "3.54", "3.64", "3.73", "3.83", "3.90",
                "3.99", "4.07", "4.11", "4.18", "4.21", "4.28", "4.37", "4.41", "4.46", "4.5", "4.55", "4.63", "4.68",
                "4.72", "4.73", "4.77", "4.82", "4.83", "4.88", "4.90", "4.97", "5.00", "5.02", "5.06", "5.10", "5.12", "5.15"
            ]
        };

        // 普朗克常数标准值
        const STANDARD_PLANCK = 6.62607015e-34;

        // 图表实例
        let u0ChartInstance = null;
        let iUChartInstance = null;
        
        // 思考题参考答案显示/隐藏
        function toggleAnswer(questionNum) {
            const answerDiv = document.getElementById(`answer${questionNum}`);
            const button = event.target;
            
            if (answerDiv.style.display === 'block') {
                answerDiv.style.display = 'none';
                button.textContent = '显示参考答案';
            } else {
                answerDiv.style.display = 'block';
                button.textContent = '隐藏参考答案';
            }
        }

        // 填入参考数据
        function fillReferenceData() {
            if (confirm("警告：参考数据仅供对照使用！若直接搬用参考数据，数据部分将计0分！\n\n是否继续填入参考数据？")) {
                // 填入表1数据
                const u0Inputs = document.querySelectorAll('.u0-data');
                u0Inputs.forEach((input, index) => {
                    input.value = referenceData.u0[index];
                });
                
                // 填入表2数据
                const i365Inputs = document.querySelectorAll('.i365-data');
                i365Inputs.forEach((input, index) => {
                    input.value = referenceData.i365[index];
                });
                
                // 填入表3数据
                const i405Inputs = document.querySelectorAll('.i405-data');
                i405Inputs.forEach((input, index) => {
                    input.value = referenceData.i405[index];
                });
                
                calculateData();
                drawCharts();
                
                alert("参考数据已填入。请注意：这些数据仅供对照，实际实验必须使用自己测量的数据！");
            }
        }

        // 检查是否使用了参考数据
        function checkReferenceDataUsage() {
            let referenceCount = 0;
            let totalCount = 0;
            
            // 检查截止电压数据
            const u0Inputs = document.querySelectorAll('.u0-data');
            u0Inputs.forEach((input, index) => {
                const uValue = parseFloat(input.value) || 0;
                
                if (uValue !== 0) {
                    totalCount++;
                    
                    // 检查是否与参考数据完全匹配
                    if (Math.abs(uValue - parseFloat(referenceData.u0[index])) < 0.01) {
                        referenceCount++;
                    }
                }
            });
            
            // 如果超过80%的数据与参考数据完全匹配，判定为直接搬用
            if (totalCount > 0 && (referenceCount / totalCount) > 0.8) {
                return true;
            }
            return false;
        }

        // 更新单个填空题的状态图标
        function updateAnswerStatusIcon(inputElement, status) {
            const statusIcon = inputElement.nextElementSibling;
            if (statusIcon && statusIcon.classList.contains('answer-status')) {
                // 清除之前的样式
                statusIcon.classList.remove('correct-icon', 'incorrect-icon', 'empty-icon');
                
                // 设置新样式和图标
                if (status === 'correct') {
                    statusIcon.textContent = '✓';
                    statusIcon.classList.add('correct-icon');
                } else if (status === 'incorrect') {
                    statusIcon.textContent = '✗';
                    statusIcon.classList.add('incorrect-icon');
                } else if (status === 'empty') {
                    statusIcon.textContent = '○';
                    statusIcon.classList.add('empty-icon');
                } else {
                    statusIcon.textContent = '';
                }
            }
        }

        // 计算实验数据
        function calculateData() {
            // 获取表1数据
            const frequencies = [8.214, 7.408, 6.879, 5.49, 5.196];
            const u0Inputs = document.querySelectorAll('.u0-data');
            const u0Values = Array.from(u0Inputs).map(input => parseFloat(input.value) || 0);
            
            // 线性拟合计算斜率和截距
            const n = frequencies.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            
            for (let i = 0; i < n; i++) {
                if (u0Values[i] !== 0) { // 只使用有效数据
                    sumX += frequencies[i];
                    sumY += u0Values[i];
                    sumXY += frequencies[i] * u0Values[i];
                    sumX2 += frequencies[i] * frequencies[i];
                    sumY2 += u0Values[i] * u0Values[i];
                }
            }
            
            // 计算斜率和截距
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // 计算相关系数 R²
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            const correlationCoefficient = numerator / denominator;
            const rSquared = correlationCoefficient * correlationCoefficient;
            
            // 计算普朗克常数（斜率需要除以10^14）
            const slopeCorrected = slope / 1e14;
            const e = 1.602e-19;
            const h = slopeCorrected * e;
            
            // 计算误差
            const absoluteError = Math.abs(h - STANDARD_PLANCK);
            const relativeError = (absoluteError / STANDARD_PLANCK) * 100;
            
            // 修正显示：斜率应该是原数值，不需要除以10^14
            document.getElementById('slopeValue').textContent = slope.toFixed(4);
            document.getElementById('planckConstant').textContent = h.toExponential(3);
            document.getElementById('equation').textContent = `y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}`;
            document.getElementById('absoluteError').textContent = absoluteError.toExponential(3);
            document.getElementById('relativeError').textContent = relativeError.toFixed(2);
            document.getElementById('correlationCoefficient').textContent = rSquared.toFixed(4);
            
            return { frequencies, u0Values, slope, intercept, rSquared, h };
        }

        // 绘制图表
        function drawCharts() {
            const result = calculateData();
            const { frequencies, u0Values, slope, intercept, rSquared } = result;
            
            // 绘制U0-ν关系图
            const u0Ctx = document.getElementById('u0Chart').getContext('2d');
            
            // 如果已有图表实例，先销毁
            if (window.u0ChartInstance) {
                window.u0ChartInstance.destroy();
            }
            
            // 计算拟合线上的点
            const fitX = [Math.min(...frequencies), Math.max(...frequencies)];
            const fitY = fitX.map(x => slope * x + intercept);
            
            window.u0ChartInstance = new Chart(u0Ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: '实验数据点',
                            data: frequencies.map((f, i) => ({x: f, y: u0Values[i]})),
                            backgroundColor: 'rgba(54, 162, 235, 0.8)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            pointRadius: 6
                        },
                        {
                            label: '线性拟合',
                            data: fitX.map((x, i) => ({x: x, y: fitY[i]})),
                            type: 'line',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '频率 ν (×10¹⁴ Hz)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '截止电压 U₀ (V)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'U₀ — ν 关系图及线性拟合'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `频率: ${context.parsed.x}×10¹⁴ Hz, 截止电压: ${context.parsed.y} V`;
                                    } else {
                                        return `拟合线: y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            // 获取I-U数据
            const uAKValues = Array.from({length: 53}, (_, i) => i - 2); // -2到50
            const i365Inputs = document.querySelectorAll('.i365-data');
            const i365Values = Array.from(i365Inputs).map(input => parseFloat(input.value) || 0);
            
            const i405Inputs = document.querySelectorAll('.i405-data');
            const i405Values = Array.from(i405Inputs).map(input => parseFloat(input.value) || 0);
            
            // 绘制I-UAK关系图
            const iUCtx = document.getElementById('iUChart').getContext('2d');
            
            // 如果已有图表实例，先销毁
            if (window.iUChartInstance) {
                window.iUChartInstance.destroy();
            }
            
            window.iUChartInstance = new Chart(iUCtx, {
                type: 'line',
                data: {
                    labels: uAKValues,
                    datasets: [
                        {
                            label: '365nm',
                            data: i365Values,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: '405nm',
                            data: i405Values,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'U_AK (V)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'I (nA)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'I — U_AK 关系图'
                        }
                    }
                }
            });
        }

        // 计算预习分数
        function calculatePreScore() {
            const inputs = document.querySelectorAll('.fill-blank');
            let correct = 0;
            let total = inputs.length;
            let emptyCount = 0;

            inputs.forEach(input => {
                const userAnswer = input.value.trim();
                const id = input.id;
                const correctAnswersList = answers[id];
                
                // 清除之前的样式
                input.classList.remove('correct', 'incorrect', 'empty');
                
                if (userAnswer === '') {
                    // 未填写的情况
                    emptyCount++;
                    input.classList.add('empty');
                    updateAnswerStatusIcon(input, 'empty');
                } else if (correctAnswersList && correctAnswersList.some(correctAnswer => userAnswer === correctAnswer)) {
                    // 回答正确
                    correct++;
                    input.classList.add('correct');
                    updateAnswerStatusIcon(input, 'correct');
                } else {
                    // 回答错误
                    input.classList.add('incorrect');
                    updateAnswerStatusIcon(input, 'incorrect');
                }
            });

            // 计算分数，未答题不计入正确
            const score = Math.round((correct / total) * 100);
            
            // 显示结果
            let scoreText = `预习分数：${score}分（答对${correct}/${total}题）`;
            if (emptyCount > 0) {
                scoreText += `，未答：${emptyCount}题`;
            }
            if (correct === total) {
                scoreText += " 🎉 满分！";
            } else if (correct === 0) {
                scoreText += " 😢 请认真预习后再作答！";
            }
            
            document.getElementById('scoreDisplay').innerHTML = scoreText;
            return {score, correct, total, emptyCount};
        }

        // 自动评分并生成评语
        function autoGrade() {
            const preScoreResult = calculatePreScore();
            const preScore = preScoreResult.score;
            const summary = document.getElementById('summary').value.trim();
            const chartDrawn = (window.u0ChartInstance !== null);
            
            // 获取计算结果
            const result = calculateData();
            const hValue = result.h || 0;
            const rSquared = result.rSquared || 0;
            
            // 计算普朗克常数的相对误差
            const relativeError = hValue > 0 ? Math.abs(hValue - STANDARD_PLANCK) / STANDARD_PLANCK * 100 : 100;
            
            // 检查是否使用了参考数据
            const usedReferenceData = checkReferenceDataUsage();
            
            // 计算报告得分
            let totalScore = 0;
            let scoreBreakdown = [];
            
            // 1. 预习填空（20%）
            const preScoreWeighted = Math.round(preScore * 0.20);
            totalScore += preScoreWeighted;
            scoreBreakdown.push(`预习填空：${preScore}×20%=${preScoreWeighted}`);
            
            // 2. 数据及其合理性（25%）- 直接搬用参考数据计0分
            let dataScore = 0;
            if (usedReferenceData) {
                // 如果直接搬用参考数据，数据部分得0分
                dataScore = 0;
                scoreBreakdown.push(`数据记录：0×25%=0（直接搬用参考数据）`);
            } else {
                // 计算数据完整性分数
                let dataCompleteness = 0;
                const dataInputs = document.querySelectorAll('.data-input');
                let filledCount = 0;
                dataInputs.forEach(input => {
                    if (input.value.trim() !== '') filledCount++;
                });
                dataCompleteness = Math.round((filledCount / dataInputs.length) * 100);
                
                // 检查实验结果合理性（普朗克常数相对误差）
                let experimentQuality = 0;
                if (relativeError < 10) {
                    experimentQuality = 100;
                } else if (relativeError < 20) {
                    experimentQuality = 80;
                } else if (relativeError < 40) {
                    experimentQuality = 60;
                } else if (relativeError < 60) {
                    experimentQuality = 40;
                } else if (relativeError < 80) {
                    experimentQuality = 20;
                } else {
                    experimentQuality = 0;
                }
                
                dataScore = Math.round((dataCompleteness * 0.6 + experimentQuality * 0.4) * 0.25);
                scoreBreakdown.push(`数据完整性与合理性：(${dataCompleteness}×60%+${experimentQuality}×40%)×0.25=${dataScore}`);
            }
            totalScore += dataScore;
            
            // 3. 数据计算与验证（15%）
            let calculationScore = 0;
            if (hValue > 0 && !usedReferenceData) {
                // 检查计算质量
                let calcQuality = 0;
                if (rSquared > 0.95) calcQuality = 100;
                else if (rSquared > 0.90) calcQuality = 80;
                else if (rSquared > 0.85) calcQuality = 60;
                else if (rSquared > 0.70) calcQuality = 40;
                else if (rSquared > 0) calcQuality = 20;
                else calcQuality = 0;
                
                calculationScore = Math.round(calcQuality * 0.15);
            }
            totalScore += calculationScore;
            scoreBreakdown.push(`计算结果：${calculationScore/0.15}×15%=${calculationScore}`);
            
            // 4. 图表（15%）
            let chartScore = 0;
            if (chartDrawn) chartScore = 100;
            
            const chartScoreWeighted = Math.round(chartScore * 0.15);
            totalScore += chartScoreWeighted;
            scoreBreakdown.push(`图表绘制：${chartScore}×15%=${chartScoreWeighted}`);
            
            // 5. 思考题（15%）
            let thoughtScore = 0;
            const thoughtInputs = document.querySelectorAll('.thought-input');
            let thoughtFilled = 0;
            let thoughtTotalLength = 0;
            
            thoughtInputs.forEach(input => {
                const answer = input.value.trim();
                if (answer !== '') {
                    thoughtFilled++;
                    thoughtTotalLength += answer.length;
                }
            });
            
            // 根据填写情况和内容质量评分
            const fillRate = thoughtFilled / thoughtInputs.length;
            const avgLength = thoughtFilled > 0 ? thoughtTotalLength / thoughtFilled : 0;
            
            if (fillRate === 1 && avgLength > 50) thoughtScore = 100;
            else if (fillRate >= 0.8 && avgLength > 40) thoughtScore = 80;
            else if (fillRate >= 0.6 && avgLength > 30) thoughtScore = 60;
            else if (fillRate >= 0.4 && avgLength > 20) thoughtScore = 40;
            else if (fillRate >= 0.2) thoughtScore = 20;
            else thoughtScore = 0;
            
            const thoughtScoreWeighted = Math.round(thoughtScore * 0.15);
            totalScore += thoughtScoreWeighted;
            scoreBreakdown.push(`思考题：${thoughtScore}×15%=${thoughtScoreWeighted}`);
            
            // 6. 小结（10%）
            let summaryScore = 0;
            const summaryLength = summary.length;
            // 检查关键词数量
            const keywords = ['光电效应', '普朗克常数', '截止电压', '光子', '量子性', '爱因斯坦', '实验', '收获', '问题', '理解'];
            let keywordCount = 0;
            keywords.forEach(keyword => {
                if (summary.includes(keyword)) keywordCount++;
            });
            
            if (summaryLength > 100 && keywordCount >= 5) summaryScore = 100;
            else if (summaryLength > 80 && keywordCount >= 4) summaryScore = 80;
            else if (summaryLength > 60 && keywordCount >= 3) summaryScore = 60;
            else if (summaryLength > 40 && keywordCount >= 2) summaryScore = 40;
            else if (summaryLength > 20) summaryScore = 20;
            else summaryScore = 0;
            
            const summaryScoreWeighted = Math.round(summaryScore * 0.1);
            totalScore += summaryScoreWeighted;
            scoreBreakdown.push(`实验小结：${summaryScore}×10%=${summaryScoreWeighted}`);
            
            // 生成评语
            let comment = "";
            let grade = "不及格";
            let gradeColor = "#c62828";
            
            if (usedReferenceData) {
                grade = "不及格";
                gradeColor = "#c62828";
                comment = `❌ 实验报告不合格！检测到直接搬用参考数据，数据部分计0分！报告得分${totalScore}分。必须使用实际实验测量数据完成报告！`;
            } else if (totalScore >= 90) {
                grade = "优秀";
                gradeColor = "#2e7d32";
                comment = `🎉 实验报告非常出色！综合得分${totalScore}分。预习扎实（${preScore}分），数据记录完整准确，普朗克常数计算合理（${hValue.toExponential(3)} J·s，相对误差${relativeError.toFixed(1)}%），思考题回答充分，小结详实。`;
            } else if (totalScore >= 80) {
                grade = "良好";
                gradeColor = "#388e3c";
                comment = `👍 实验报告质量较高！综合得分${totalScore}分。预习较好（${preScore}分），数据记录较为完整，普朗克常数计算基本合理（${hValue.toExponential(3)} J·s，相对误差${relativeError.toFixed(1)}%），分析较为充分。`;
            } else if (totalScore >= 70) {
                grade = "中等";
                gradeColor = "#f57c00";
                comment = `✊ 实验报告基本合格！综合得分${totalScore}分。预习一般（${preScore}分），数据记录和计算存在一定误差，分析较为简单。`;
            } else if (totalScore >= 60) {
                grade = "及格";
                gradeColor = "#ff9800";
                comment = `⚠️ 实验报告勉强及格！综合得分${totalScore}分。预习不足（${preScore}分），数据记录或计算存在明显问题，分析不足。`;
            } else {
                grade = "不及格";
                gradeColor = "#d32f2f";
                comment = `❌ 实验报告未达到基本要求！报告得分${totalScore}分。请重新认真学习实验原理，补充完整实验记录！`;
            }
            
            // 具体建议
            let suggestions = [];
            if (preScore < 70) suggestions.push("预习部分需要加强，请认真阅读实验原理");
            if (usedReferenceData) suggestions.push("必须使用实际测量数据");
            else if (dataScore < 15) suggestions.push("数据记录需要更加完整准确");
            if (calculationScore < 10) suggestions.push("数据计算需要更精确，请检查计算过程");
            if (thoughtScore < 60) suggestions.push("思考题回答需要更加充分详细");
            if (summaryScore < 60) suggestions.push("实验小结需要更加详实，应包含实验收获、问题和改进建议");
            if (chartScoreWeighted < 10) suggestions.push("请完成图表的绘制和分析");
            
            if (suggestions.length > 0) {
                comment += ` 改进建议：${suggestions.join('；')}。`;
            }
            
            // 显示详细分数分解
            comment += ` 评分详情：${scoreBreakdown.join('，')}，总评：${grade}（${totalScore}分）。`;
            
            // 获取指导教师姓名和当前日期
            const teacherName = document.getElementById('instructor').value || '未填写';
            const currentDate = new Date().toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // 更新评语内容
            document.getElementById('commentContent').innerHTML = comment;
            document.getElementById('commentContent').style.color = gradeColor;
            document.getElementById('teacherName').textContent = teacherName;
            document.getElementById('currentDate').textContent = currentDate;
            document.getElementById('commentFooter').style.display = 'block';
            
            // 显示提示
            alert(`自动评分完成！\n报告得分: ${totalScore}分\n评分等级: ${grade}\n请查看下方详细评语。`);
        }

        // 初始化页面
        window.onload = function() {
            // 添加输入框变化监听
            const dataInputs = document.querySelectorAll('.data-input');
            dataInputs.forEach(input => {
                input.addEventListener('change', function() {
                    // 自动计算数据
                    calculateData();
                });
            });
            
            // 添加填空框变化监听
            const fillBlanks = document.querySelectorAll('.fill-blank');
            fillBlanks.forEach(input => {
                input.addEventListener('change', function() {
                    // 移除之前的样式
                    this.classList.remove('correct', 'incorrect', 'empty');
                    
                    // 清空状态图标
                    const statusIcon = this.nextElementSibling;
                    if (statusIcon && statusIcon.classList.contains('answer-status')) {
                        statusIcon.textContent = '';
                        statusIcon.classList.remove('correct-icon', 'incorrect-icon', 'empty-icon');
                    }
                });
            });
            
            // 初始化计算数据
            calculateData();
        };
    </script>
</body>
</html>
