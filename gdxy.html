<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光电效应实验</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        h2 {
            margin: 20px 0 10px;
            color: #444;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        h3 {
            margin: 15px 0 10px;
            color: #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"] {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .section {
            margin-bottom: 30px;
        }
        .chart-container {
            margin: 20px 0;
            position: relative;
            height: 400px;
            width: 100%;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .score-section {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        .calculation-result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .blank {
            width: 120px;
            display: inline-block;
            margin: 0 5px;
        }
        .data-input {
            width: 80px;
        }
        .data-table {
            font-size: 12px;
        }
        .data-table td {
            padding: 4px;
        }
        .theory-content {
            margin-bottom: 15px;
        }
        .voltage-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 5px;
        }
        .voltage-cell {
            width: 60px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .voltage-cell input {
            width: 100%;
        }
        .voltage-label {
            font-weight: bold;
            width: 100px;
        }
        .voltage-section {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        .voltage-section h4 {
            margin-bottom: 10px;
            color: #666;
        }
        .equation {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            margin: 15px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 3px;
            text-align: center;
            font-size: 18px;
        }
        .equation span {
            margin: 0 3px;
        }
        .correct-answer {
            color: #4CAF50;
            font-size: 12px;
            margin-top: 5px;
        }
        .error-calculation {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff3cd;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        .standard-value {
            color: #28a745;
            font-weight: bold;
        }
        .error-value {
            color: #dc3545;
            font-weight: bold;
        }
        
        /* 物理符号样式 */
        sub, sup {
            font-size: 0.75em;
            line-height: 0;
            position: relative;
            vertical-align: baseline;
        }
        sup {
            top: -0.5em;
        }
        sub {
            bottom: -0.25em;
        }
        
        /* 公式分数样式 */
        .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 2px;
        }
        .fraction span {
            display: block;
        }
        .fraction .numerator {
            border-bottom: 1px solid #000;
            padding-bottom: 1px;
        }
        .fraction .denominator {
            padding-top: 1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>光电效应实验</h1>
        
        <!-- 基本信息编辑部分 -->
        <div class="section">
            <h2>一、基本信息</h2>
            <table>
                <tr>
                    <td width="15%">专业</td>
                    <td width="35%"><input type="text" id="major"></td>
                    <td width="15%">班级</td>
                    <td width="35%"><input type="text" id="class"></td>
                </tr>
                <tr>
                    <td>学号</td>
                    <td><input type="text" id="studentId"></td>
                    <td>姓名</td>
                    <td><input type="text" id="name"></td>
                </tr>
                <tr>
                    <td>指导教师</td>
                    <td><input type="text" id="instructor" value="马厂"></td>
                    <td>同组人</td>
                    <td><input type="text" id="partner"></td>
                </tr>
                <tr>
                    <td>实验时间</td>
                    <td><input type="text" id="experimentTime"></td>
                    <td>实验地点</td>
                    <td><input type="text" id="experimentLocation"></td>
                </tr>
            </table>
        </div>

        <!-- 实验目的部分 -->
        <div class="section">
            <h2>二、实验目的</h2>
            <p>1.了解光电效应的规律，加深对光的<input type="text" id="purpose1" class="blank" placeholder="请填写">的认识。</p>
            <p>2.测量<input type="text" id="purpose2" class="blank" placeholder="请填写">。</p>
        </div>

        <!-- 实验仪器部分 -->
        <div class="section">
            <h2>三、实验仪器</h2>
            <p>光电效应实验仪主要由以下部件组成：</p>
            <p>查看实验指导书，根据仪器结构图填空：</p>
            <p>1.<input type="text" id="instrument1" class="blank" placeholder="请填写">；</p>
            <p>2.<input type="text" id="instrument2" class="blank" placeholder="请填写">；</p>
            <p>3.<input type="text" id="instrument3" class="blank" placeholder="请填写">；</p>
            <p>4.<input type="text" id="instrument4" class="blank" placeholder="请填写">；</p>
            <p>5.<input type="text" id="instrument5" class="blank" placeholder="请填写">；</p>
            <p>6.<input type="text" id="instrument6" class="blank" placeholder="请填写">。</p>
        </div>

        <!-- 实验原理部分 -->
        <div class="section">
            <h2>四、实验原理</h2>
            <div class="theory-content">
                <p>入射光照射到光电管阴极 K 上，产生的光电子在电场的作用下向阳极 A 迁移构成光电流，改变外加电压 U<sub>AK</sub>，测量出光电流 I 的大小，即可得出光电管的伏安特性曲线。光电效应的基本实验事实如下：</p>
                <p>(1) 对应于某一频率，光电效应的 I-U<sub>AK</sub> 关系如图 2 所示。从图中可见，对一定的频率，有一电压 U<sub>0</sub>，当 U<sub>AK</sub> ≤ U<sub>0</sub> 时，电流为零，这个相对于阴极的负值的阳极电压 U<sub>0</sub>，被称为<input type="text" id="theory1" class="blank" placeholder="请填写">。</p>
                <p>(2) 当 U<sub>AK</sub> ≥ U<sub>0</sub> 后，I 迅速增加，然后趋于饱和，饱和光电流 I<sub>M</sub> 的大小与<input type="text" id="theory2" class="blank" placeholder="请填写">成正比。</p>
                <p>(3) 对于不同频率的光，其截止电压的值不同。</p>
                <p>(4) 截止电压 U<sub>0</sub> 与频率 ν 的关系如图 4 所示，U<sub>0</sub> 与 ν 成<input type="text" id="theory3" class="blank" placeholder="请填写">。当入射光频率<input type="text" id="theory4" class="blank" placeholder="请填写">某极限值 ν<sub>0</sub>（ν<sub>0</sub> 随不同金属而异）时，不论光的强度如何，照射时间多长，都没有光电流产生。</p>
                <p>(5) 光电效应是<input type="text" id="theory5" class="blank" placeholder="请填写">效应。即使入射光的强度非常微弱，只要频率<input type="text" id="theory6" class="blank" placeholder="请填写">ν<sub>0</sub>，在开始照射后立即有光电子产生，所经过的时间至多为 10<sup>-9</sup> 秒的数量级。</p>
                <p>按照爱因斯坦的光量子理论，光能并不像电磁波理论所想象的那样，分布在波阵面上，而是集中在被称之为光子的微粒上，但这种微粒仍然保持着频率（或波长）的概念，频率为 ν 的光子具有能量 E = hν，h 为普朗克常数。当光子照射到金属表面上时，一次被金属中的电子全部吸收，而无需积累能量的时间。电子把这能量的一部分用来克服金属表面对它的吸引力，余下的就变为电子离开金属表面后的动能，按照能量守恒原理，爱因斯坦提出了著名的光电效应方程为：</p>
                
                <div class="equation">
                    hν = A + <span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup>
                </div>
                
                <p>式中，A 为金属的<input type="text" id="theory7" class="blank" placeholder="请填写">，<span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup> 为光电子获得的<input type="text" id="theory8" class="blank" placeholder="请填写">。</p>
                
                <p>由该式可见，入射到金属表面的光频率越高，逸出的电子动能越大，所以即使阳极电位比阴极电位低时也会有电子落入阳极形成光电流，直至阳极电位低于截止电压，光电流才为零，此时有关系：</p>
                
                <div class="equation">
                    eU<sub>0</sub> = <span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span>mv<sub>0</sub><sup>2</sup> = hν - A
                </div>
                
                <p>阳极电位高于截止电压后，随着阳极电位的升高，阳极对阴极发射的电子的收集作用越强，光电流随之上升；当阳极电压高到一定程度，已把阴极发射的光电子几乎全收集到阳极，再增加 U<sub>AK</sub> 时 I 不再变化，光电流出现饱和，饱和光电流 I<sub>M</sub> 的大小与入射光的强度 P 成正比。光子的能量 hν<sub>0</sub> &lt; A 时，电子不能脱离金属，因而没有光电流产生。产生光电效应的最低频率（截止频率）是 ν<sub>0</sub> = A/h。</p>
                
                <p>由上式可得：</p>
                
                <div class="equation">
                    U<sub>0</sub> = <span class="fraction"><span class="numerator">h</span><span class="denominator">e</span></span>ν - <span class="fraction"><span class="numerator">A</span><span class="denominator">e</span></span>
                </div>
                
                <p>此式表明截止电压 U<sub>0</sub> 是频率 ν 的线性函数，直线斜率 k = h/e，只要用实验方法得出不同的频率对应的截止电压，求出直线斜率，就可算出普朗克常数 h。爱因斯坦的光量子理论成功地解释了光电效应规律。</p>
            </div>
        </div>

        <!-- 实验步骤部分 -->
        <div class="section">
            <h2>五、实验步骤</h2>
            <p>1、测试前准备</p>
            <p>1）将实验仪及汞灯电源接通（盖上汞灯遮光盖，将光电管暗盒通光孔转到遮光位置），预热<input type="text" id="procedure1" class="blank" placeholder="请填写">min。</p>
            <p>2）调整光电管与汞灯距离为约<input type="text" id="procedure2" class="blank" placeholder="请填写">cm 并保持不变。</p>
            <p>3）用迭插头对将光电管暗箱电压输入端与 XLAB 光电效应数控电源的电源输出端连接起来（红—红 A，黑—黑 GND）。</p>
            <p>4）用 BNC 连接线将光电管暗箱的 BNC 座（K）与 XLAB 电压表电流表的 BNC 座（pAnAuA）连接起来。</p>
            <p>2、测普朗克常数 h：</p>
            <p>测量截止电压时，将 XLAB 光电效应数控电源，设置为 PLK 模式，PLK 模式电压输出范围（-3.00V~0.00V）。将 XLAB 电压表电流表的电流表（pAnAuA）档位设置为 20nA 档或200nA。</p>
            <p>注：XLAB 电压表电流表的电流表（pAnAuA）的档位切换操作，通过点击 XLAB 电压表电流表的电流表（pAnAuA）显示区域，在电流表（pAnAuA）档位界面，点击指定档位。</p>
            <p>实验步骤：</p>
            <p>1. 将 XLAB 光电效应数控电源，设置为 PLK 模式。电压的设置：方式一：通过点击"－"减少电压，点击"+"增加电压。方式二：通过点击"电压显示框"，在弹出的键盘设置电压。</p>
            <p>2. 打开汞灯遮光盖，将光阑旋转到直径 4mm 的位置，将滤色片旋转到<input type="text" id="procedure3" class="blank" placeholder="请填写">nm 的位置。此时电流表显示与 U<sub>AK</sub> 对应的电流值 I。</p>
            <p>3. 从 0.00V 开始，减少电压（向-3.00V），开始观察电流值的变化，寻找电流为零（光电管暗盒通光孔转到遮光位置的电流值不为零，此值对应的电压值就是截止电压）时对应的U<sub>AK</sub>，以其绝对值作为该波长对应的 U<sub>0</sub>的值，并将数据记于表 1 中。依次旋转选择 577 nm，546.nm,，436 nm，405，365 nm，的滤色片，重复以上测量步骤。</p>
            <p>3、测光电管的伏安特性曲线：</p>
            <p>1. 此时，将 XLAB 光电效应数控电源，设置为 VA 模式。电压的设置：方式一：通过点击"－"减少电压，点击"+"增加电压。方式二：通过点击"电压显示框"，在弹出的键盘设置电压。</p>
            <p>2. 将光阑旋转到直径 4mm 的位置，将滤色片旋转到 365nm 的位置，距离<input type="text" id="procedure4" class="blank" placeholder="请填写">cm。伏安特性曲线测量的最大范围为-2V～50V。测量时每隔 0.5V 或 1V 记录。记录所测 U<sub>AK</sub> 及 I 的数据。换上 405nm 的滤色片，重复上述实验步骤。</p>
        </div>

        <!-- 实验数据记录部分 -->
        <div class="section">
            <h2>六、实验数据记录</h2>
            
            <h3>表1：U<sub>0</sub> — ν 关系 光阑孔 Φ = 4 mm</h3>
            <table>
                <tr>
                    <th>波长 λ<sub>i</sub> (nm)</th>
                    <td>365</td>
                    <td>404.7</td>
                    <td>435.8</td>
                    <td>546.1</td>
                    <td>577</td>
                </tr>
                <tr>
                    <th>频率 ν<sub>i</sub> (×10¹⁴ Hz)</th>
                    <td>8.214</td>
                    <td>7.408</td>
                    <td>6.879</td>
                    <td>5.49</td>
                    <td>5.196</td>
                </tr>
                <tr>
                    <th>截止电压 U<sub>0i</sub>（V）</th>
                    <td><input type="text" class="u0-data data-input" placeholder="输入数据"></td>
                    <td><input type="text" class="u0-data data-input" placeholder="输入数据"></td>
                    <td><input type="text" class="u0-data data-input" placeholder="输入数据"></td>
                    <td><input type="text" class="u0-data data-input" placeholder="输入数据"></td>
                    <td><input type="text" class="u0-data data-input" placeholder="输入数据"></td>
                </tr>
            </table>

            <h3>表2：I — U<sub>AK</sub> 关系 光阑孔 Φ = 4 mm, 滤色片 365nm</h3>
            
            <div class="voltage-section">
                <h4>电压 U<sub>AK</sub> / V 从 -2V 到 50V</h4>
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">-2</div>
                    <div class="voltage-cell">-1</div>
                    <div class="voltage-cell">0</div>
                    <div class="voltage-cell">1</div>
                    <div class="voltage-cell">2</div>
                    <div class="voltage-cell">3</div>
                    <div class="voltage-cell">4</div>
                    <div class="voltage-cell">5</div>
                    <div class="voltage-cell">6</div>
                    <div class="voltage-cell">7</div>
                    <div class="voltage-cell">8</div>
                    <div class="voltage-cell">9</div>
                    <div class="voltage-cell">10</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">11</div>
                    <div class="voltage-cell">12</div>
                    <div class="voltage-cell">13</div>
                    <div class="voltage-cell">14</div>
                    <div class="voltage-cell">15</div>
                    <div class="voltage-cell">16</div>
                    <div class="voltage-cell">17</div>
                    <div class="voltage-cell">18</div>
                    <div class="voltage-cell">19</div>
                    <div class="voltage-cell">20</div>
                    <div class="voltage-cell">21</div>
                    <div class="voltage-cell">22</div>
                    <div class="voltage-cell">23</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">24</div>
                    <div class="voltage-cell">25</div>
                    <div class="voltage-cell">26</div>
                    <div class="voltage-cell">27</div>
                    <div class="voltage-cell">28</div>
                    <div class="voltage-cell">29</div>
                    <div class="voltage-cell">30</div>
                    <div class="voltage-cell">31</div>
                    <div class="voltage-cell">32</div>
                    <div class="voltage-cell">33</div>
                    <div class="voltage-cell">34</div>
                    <div class="voltage-cell">35</div>
                    <div class="voltage-cell">36</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">37</div>
                    <div class="voltage-cell">38</div>
                    <div class="voltage-cell">39</div>
                    <div class="voltage-cell">40</div>
                    <div class="voltage-cell">41</div>
                    <div class="voltage-cell">42</div>
                    <div class="voltage-cell">43</div>
                    <div class="voltage-cell">44</div>
                    <div class="voltage-cell">45</div>
                    <div class="voltage-cell">46</div>
                    <div class="voltage-cell">47</div>
                    <div class="voltage-cell">48</div>
                    <div class="voltage-cell">49</div>
                    <div class="voltage-cell">50</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i365-data data-input" placeholder="输入"></div>
                </div>
            </div>

            <h3>表3：I — U<sub>AK</sub> 关系 光阑孔 Φ = 4 mm, 滤色片 405nm</h3>
            
            <div class="voltage-section">
                <h4>电压 U<sub>AK</sub> / V 从 -2V 到 50V</h4>
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">-2</div>
                    <div class="voltage-cell">-1</div>
                    <div class="voltage-cell">0</div>
                    <div class="voltage-cell">1</div>
                    <div class="voltage-cell">2</div>
                    <div class="voltage-cell">3</div>
                    <div class="voltage-cell">4</div>
                    <div class="voltage-cell">5</div>
                    <div class="voltage-cell">6</div>
                    <div class="voltage-cell">7</div>
                    <div class="voltage-cell">8</div>
                    <div class="voltage-cell">9</div>
                    <div class="voltage-cell">10</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">11</div>
                    <div class="voltage-cell">12</div>
                    <div class="voltage-cell">13</div>
                    <div class="voltage-cell">14</div>
                    <div class="voltage-cell">15</div>
                    <div class="voltage-cell">16</div>
                    <div class="voltage-cell">17</div>
                    <div class="voltage-cell">18</div>
                    <div class="voltage-cell">19</div>
                    <div class="voltage-cell">20</div>
                    <div class="voltage-cell">21</div>
                    <div class="voltage-cell">22</div>
                    <div class="voltage-cell">23</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">24</div>
                    <div class="voltage-cell">25</div>
                    <div class="voltage-cell">26</div>
                    <div class="voltage-cell">27</div>
                    <div class="voltage-cell">28</div>
                    <div class="voltage-cell">29</div>
                    <div class="voltage-cell">30</div>
                    <div class="voltage-cell">31</div>
                    <div class="voltage-cell">32</div>
                    <div class="voltage-cell">33</div>
                    <div class="voltage-cell">34</div>
                    <div class="voltage-cell">35</div>
                    <div class="voltage-cell">36</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                </div>
                
                <div class="voltage-row">
                    <div class="voltage-label">电压 (V):</div>
                    <div class="voltage-cell">37</div>
                    <div class="voltage-cell">38</div>
                    <div class="voltage-cell">39</div>
                    <div class="voltage-cell">40</div>
                    <div class="voltage-cell">41</div>
                    <div class="voltage-cell">42</div>
                    <div class="voltage-cell">43</div>
                    <div class="voltage-cell">44</div>
                    <div class="voltage-cell">45</div>
                    <div class="voltage-cell">46</div>
                    <div class="voltage-cell">47</div>
                    <div class="voltage-cell">48</div>
                    <div class="voltage-cell">49</div>
                    <div class="voltage-cell">50</div>
                </div>
                <div class="voltage-row">
                    <div class="voltage-label">电流 I (nA):</div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                    <div class="voltage-cell"><input type="text" class="i405-data data-input" placeholder="输入"></div>
                </div>
            </div>
        </div>

        <!-- 图表分析部分 -->
        <div class="section">
            <h2>七、图表分析</h2>
            
            <div class="chart-container">
                <canvas id="u0Chart"></canvas>
            </div>
            
            <div class="calculation-result">
                <p>斜率 k = <span id="slopeValue">0</span> V·s</p>
                <p>普朗克常数 h = <span id="planckConstant">0</span> J·s</p>
                <p>线性拟合方程: <span id="equation">y = kx + b</span></p>
                
                <div class="error-calculation">
                    <h4>误差分析</h4>
                    <p>普朗克常数标准值: <span class="standard-value">6.62607015×10⁻³⁴ J·s</span></p>
                    <p>绝对误差 Δh = <span id="absoluteError">0</span> J·s</p>
                    <p>相对误差 E = <span id="relativeError">0</span> %</p>
                    <p>线性相关系数 R² = <span id="correlationCoefficient">0</span></p>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="iUChart"></canvas>
            </div>
            
            <button class="btn" id="drawChartsBtn">绘制图表</button>
            <button class="btn" id="fillReferenceBtn">填入参考数据</button>
        </div>

        <!-- 实验小结部分 -->
        <div class="section">
            <h2>八、实验小结</h2>
            <textarea id="summary" placeholder="请填写实验小结"></textarea>
        </div>

        <!-- 实验预习分数 -->
        <div class="section score-section">
            <h2>实验预习分数</h2>
            <p>实验预习分数：（<input type="text" id="preparationScore" readonly>）</p>
            <button class="btn" id="calculateScoreBtn">计算预习分数</button>
        </div>
    </div>

    <script>
        // 答案定义（允许多个正确答案）
        const answers = {
            purpose1: ["量子性"],
            purpose2: ["普朗克常量", "普朗克常数", "普朗克常量h"],
            instrument1: ["汞灯电源"],
            instrument2: ["汞灯"],
            instrument3: ["滤色片"],
            instrument4: ["光阑"],
            instrument5: ["光电管"],
            instrument6: ["基座"],
            theory1: ["截止电压"],
            theory2: ["入射光的强度", "入射光强度"],
            theory3: ["正比"],
            theory4: ["小于", "低于"],
            theory5: ["瞬时"],
            theory6: ["高于", "大于"],
            theory7: ["逸出功"],
            theory8: ["初始动能"],
            procedure1: ["20"],
            procedure2: ["20"],
            procedure3: ["365.0", "365"],
            procedure4: ["40"]
        };

        // 参考数据
        const referenceData = {
            u0: ["1.63", "1.20", "0.98", "0.64", "0.41"],
            i365: [
                "-0.1", "0.16", "0.47", "1.11", "1.70", "2.41", "3.24", "3.90", "4.52", "5.12", "5.70", "6.27", "6.81",
                "7.29", "7.73", "8.24", "8.62", "8.93", "9.29", "9.59", "9.88", "10.24", "10.47", "10.70", "11", "11.4",
                "11.62", "11.85", "12.06", "12.26", "12.46", "12.65", "12.80", "12.97", "13.16", "13.30", "13.45", "13.59", "13.70",
                "13.82", "13.92", "14.13", "14.21", "14.28", "14.40", "14.50", "14.55", "14.60", "14.70", "14.78", "14.89", "15.00", "15.05"
            ],
            i405: [
                "0", "0.04", "0.21", "0.42", "0.70", "0.98", "1.25", "1.47", "1.68", "1.88", "2.05", "2.25", "2.43",
                "2.59", "2.76", "2.92", "3.02", "3.13", "3.24", "3.31", "3.45", "3.54", "3.64", "3.73", "3.83", "3.90",
                "3.99", "4.07", "4.11", "4.18", "4.21", "4.28", "4.37", "4.41", "4.46", "4.5", "4.55", "4.63", "4.68",
                "4.72", "4.73", "4.77", "4.82", "4.83", "4.88", "4.90", "4.97", "5.00", "5.02", "5.06", "5.10", "5.12", "5.15"
            ]
        };

        // 普朗克常数标准值
        const STANDARD_PLANCK = 6.62607015e-34;

        // 填入参考数据
        document.getElementById('fillReferenceBtn').addEventListener('click', function() {
            // 填入表1数据
            const u0Inputs = document.querySelectorAll('.u0-data');
            u0Inputs.forEach((input, index) => {
                input.value = referenceData.u0[index];
            });
            
            // 填入表2数据
            const i365Inputs = document.querySelectorAll('.i365-data');
            i365Inputs.forEach((input, index) => {
                input.value = referenceData.i365[index];
            });
            
            // 填入表3数据
            const i405Inputs = document.querySelectorAll('.i405-data');
            i405Inputs.forEach((input, index) => {
                input.value = referenceData.i405[index];
            });
            
            alert("参考数据已填入！仅供参考，若直接使用，将作0分处理");
        });

        // 计算预习分数
        document.getElementById('calculateScoreBtn').addEventListener('click', function() {
            let score = 0;
            
            // 检查每个填空
            for (const [id, correctAnswers] of Object.entries(answers)) {
                const input = document.getElementById(id);
                if (input) {
                    const userAnswer = input.value.trim();
                    // 检查用户答案是否在正确答案数组中
                    if (correctAnswers.some(correctAnswer => userAnswer === correctAnswer)) {
                        score += 5;
                    }
                }
            }
            
            document.getElementById('preparationScore').value = score;
        });

        // 绘制图表
        document.getElementById('drawChartsBtn').addEventListener('click', function() {
            // 获取表1数据
            const frequencies = [8.214, 7.408, 6.879, 5.49, 5.196];
            const u0Inputs = document.querySelectorAll('.u0-data');
            const u0Values = Array.from(u0Inputs).map(input => parseFloat(input.value) || 0);
            
            // 线性拟合计算斜率和截距
            const n = frequencies.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += frequencies[i];
                sumY += u0Values[i];
                sumXY += frequencies[i] * u0Values[i];
                sumX2 += frequencies[i] * frequencies[i];
                sumY2 += u0Values[i] * u0Values[i];
            }
            
            // 计算斜率和截距
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // 计算相关系数 R²
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            const correlationCoefficient = numerator / denominator;
            const rSquared = correlationCoefficient * correlationCoefficient;
            
            // 计算拟合线上的点
            const fitX = [Math.min(...frequencies), Math.max(...frequencies)];
            const fitY = fitX.map(x => slope * x + intercept);
            
            // 绘制U0-ν关系图
            const u0Ctx = document.getElementById('u0Chart').getContext('2d');
            
            // 如果已有图表实例，先销毁
            if (window.u0ChartInstance) {
                window.u0ChartInstance.destroy();
            }
            
            window.u0ChartInstance = new Chart(u0Ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: '实验数据点',
                            data: frequencies.map((f, i) => ({x: f, y: u0Values[i]})),
                            backgroundColor: 'rgba(54, 162, 235, 0.8)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            pointRadius: 6
                        },
                        {
                            label: '线性拟合',
                            data: fitX.map((x, i) => ({x: x, y: fitY[i]})),
                            type: 'line',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '频率 ν (×10¹⁴ Hz)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '截止电压 U₀ (V)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'U₀ — ν 关系图及线性拟合'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `频率: ${context.parsed.x}×10¹⁴ Hz, 截止电压: ${context.parsed.y} V`;
                                    } else {
                                        return `拟合线: y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}`;
                                    }
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    mode: 'horizontal',
                                    scaleID: 'y',
                                    value: 0,
                                    borderColor: 'black',
                                    borderWidth: 1,
                                    borderDash: [5, 5]
                                }
                            }
                        }
                    }
                }
            });
            
            // 计算普朗克常数（斜率需要除以10^14）
            const slopeCorrected = slope / 1e14;
            const e = 1.602e-19;
            const h = slopeCorrected * e;
            
            // 计算误差
            const absoluteError = Math.abs(h - STANDARD_PLANCK);
            const relativeError = (absoluteError / STANDARD_PLANCK) * 100;
            
            // 修正显示：斜率应该是原数值，不需要除以10^14
            document.getElementById('slopeValue').textContent = slope.toFixed(4);
            document.getElementById('planckConstant').textContent = h.toExponential(3);
            document.getElementById('equation').textContent = `y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}`;
            document.getElementById('absoluteError').textContent = absoluteError.toExponential(3);
            document.getElementById('relativeError').textContent = relativeError.toFixed(2);
            document.getElementById('correlationCoefficient').textContent = rSquared.toFixed(4);
            
            // 获取表2和表3数据
            const uAKValues = Array.from({length: 53}, (_, i) => i - 2); // -2到50
            const i365Inputs = document.querySelectorAll('.i365-data');
            const i365Values = Array.from(i365Inputs).map(input => parseFloat(input.value) || 0);
            
            const i405Inputs = document.querySelectorAll('.i405-data');
            const i405Values = Array.from(i405Inputs).map(input => parseFloat(input.value) || 0);
            
            // 绘制I-UAK关系图
            const iUCtx = document.getElementById('iUChart').getContext('2d');
            
            // 如果已有图表实例，先销毁
            if (window.iUChartInstance) {
                window.iUChartInstance.destroy();
            }
            
            window.iUChartInstance = new Chart(iUCtx, {
                type: 'line',
                data: {
                    labels: uAKValues,
                    datasets: [
                        {
                            label: '365nm',
                            data: i365Values,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: '405nm',
                            data: i405Values,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'U_AK (V)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'I (nA)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'I — U_AK 关系图'
                        }
                    }
                }
            });
        });

/* ==========  教师自动评语 + 实验报告自动打分  ========== */
/* 配置区——老师可随意改 start */
const cfg = {
    // 1. 各项权重（总和 100）
    weight: {
        prepFill: 20,   // 预习填空
        dataAcc: 25,    // 数据合理性（与参考值偏离度）
        chart: 15,      // 图表是否绘制
        summary: 20,    // 实验小结（关键词 + 字数）※ 修改：要求60字以上
        errorAna: 10,   // 误差分析区是否填写
        normErr: 10     // 相对误差 < 10% 拿满，> 30% 拿 0
    },

    // 2. 数据合理性的允许相对偏差（> 该值开始扣分）
    dataDevThres: 0.15,

    // 3. 小结关键词（至少出现 1 个）
    summaryKeywords: [
        '光电效应', '截止电压', '普朗克常数', '饱和光电流', '光子能量', '爱因斯坦'
    ],

    // 4. 小结字数要求（修改：不少于60字）
    summaryMinLength: 60,
    summaryPartialLength: 30, // 部分得分的最小字数

    // 5. 分数→评语
    scoreLevel: [
        { min: 90, label: '优秀', color: '#28a745', desc: '实验完成质量高，数据可靠，思考深入。' },
        { min: 75, label: '良好', color: '#007bff', desc: '实验完整，数据合理，略有小瑕疵。' },
        { min: 60, label: '及格', color: '#ffc107', desc: '实验基本达到要求，但存在明显不足。' },
        { min: 0,  label: '待改进', color: '#dc3545', desc: '实验未完成或错误较多，请重做并参考建议。' }
    ]
};

/* 配置区 end */

/* ---- 工具函数 ---- */
// 计算数组平均相对偏差
function avgDev(ref, usr) {
    let sum = 0, n = 0;
    ref.forEach((v, i) => {
        const u = parseFloat(usr[i].value);
        if (!isNaN(u) && u !== 0) { 
            sum += Math.abs(u - parseFloat(v)) / Math.abs(parseFloat(v)); 
            n++; 
        }
    });
    return n === 0 ? 1 : sum / n;
}

// 小结关键词命中数
function keywordCount(text) {
    return cfg.summaryKeywords.filter(k => text.includes(k)).length;
}

// 统一评分入口
function calcTotalScore() {
    let score = 0;
    const sc = {}; // 子项得分明细

    /* 1. 预习填空 20% */
    let fill = 0;
    for (let [id, ans] of Object.entries(answers)) {
        if (document.getElementById(id)?.value.trim() === ans[0]) fill++;
    }
    sc.prepFill = Math.round((fill / Object.keys(answers).length) * cfg.weight.prepFill);
    score += sc.prepFill;

    /* 2. 数据合理性 25% */
    const u0Ref = referenceData.u0;
    const u0Usr = document.querySelectorAll('.u0-data');
    const dev = avgDev(u0Ref, u0Usr);
    sc.dataAcc = dev > cfg.dataDevThres ? Math.round((1 - Math.min(dev, 0.3) / 0.3) * cfg.weight.dataAcc) : cfg.weight.dataAcc;
    score += sc.dataAcc;

    /* 3. 图表 15% */
    sc.chart = (window.u0ChartInstance || window.iUChartInstance) ? cfg.weight.chart : 0;
    score += sc.chart;

    /* 4. 小结 20%（修改：字数要求60字以上） */
    const smText = document.getElementById('summary')?.value.trim() || '';
    const hit = keywordCount(smText);
    const len = smText.length;
    sc.summary = 0;
    if (hit > 0 && len >= cfg.summaryMinLength) {
        sc.summary = cfg.weight.summary;
    } else if (hit > 0 && len >= cfg.summaryPartialLength) {
        // 字数30-60字之间，给70%分数
        sc.summary = Math.round(cfg.weight.summary * 0.7);
    } else if (hit > 0) {
        // 有关键词但字数太少，给40%分数
        sc.summary = Math.round(cfg.weight.summary * 0.4);
    }
    score += sc.summary;

    /* 5. 误差分析区 10% */
    const errText = document.getElementById('relativeError')?.textContent || '0';
    const hasErr = parseFloat(errText) >= 0;
    sc.errorAna = hasErr ? cfg.weight.errorAna : 0;
    score += sc.errorAna;

    /* 6. 相对误差 bonus 10% */
    const relErr = parseFloat(errText) || 100;
    sc.normErr = relErr < 10 ? cfg.weight.normErr : relErr > 30 ? 0 : Math.round((1 - (relErr - 10) / 20) * cfg.weight.normErr);
    score += sc.normErr;

    return { total: Math.min(100, score), detail: sc };
}

/* ---- 修复QQ浏览器兼容性：改用onclick事件 ---- */
function initEvents() {
    // 使用onclick替代addEventListener提高兼容性
    document.getElementById('drawChartsBtn').onclick = function() {
        // 原有的绘制图表代码...
    };
    
    document.getElementById('fillReferenceBtn').onclick = function() {
        // 原有的填入参考数据代码...
    };
    
    document.getElementById('calculateScoreBtn').onclick = function() {
        // 原有的计算预习分数代码...
    };
}

// 页面加载完成后初始化事件
document.addEventListener('DOMContentLoaded', function() {
    initEvents();
    // 其他初始化代码...
});

/* ---- 生成评语（含教师姓名+当天日期） ---- */
function generateComment(scoreObj) {
    const { total, detail } = scoreObj;
    const lvl = cfg.scoreLevel.find(l => total >= l.min);

    // 教师信息与日期
    const teacher = '马厂';
    const today  = new Date().toLocaleDateString('zh-CN');

    let sug = [];
    if (detail.dataAcc < cfg.weight.dataAcc * 0.7) 
        sug.push('建议重新检查截止电压读数，确保从 0 nA 附近开始缓慢扫描。');
    if (detail.summary < cfg.weight.summary * 0.7) 
        sug.push(`实验小结需体现"光子能量""截止电压"等关键词，并不少于 ${cfg.summaryMinLength} 字（当前建议 ${cfg.summaryMinLength}+ 字）。`);
    if (detail.chart === 0) 
        sug.push('请先点击"绘制图表"按钮，生成 U₀-ν 与 I-U 两图后再评分。');
    if (sug.length === 0) 
        sug.push('报告完整，继续保持！');

    const comment = `【自动评语】\n得分：${total} / 100，等级：${lvl.label}\n${lvl.desc}\n\n明细：\n预习 ${detail.prepFill} | 数据 ${detail.dataAcc} | 图表 ${detail.chart}\n小结 ${detail.summary} | 误差 ${detail.errorAna} | 精密度 ${detail.normErr}\n\n改进建议：\n${sug.map(s => '· ' + s).join('\n')}\n\n教师：${teacher}\n日期：${today}`;

    return { text: comment, lvl };
}

/* ---- 按钮与渲染 ---- */
// 在页面任意位置放"自动评分"按钮，这里示例插在"计算预习分数"按钮后面
const autoScoreBtn = document.createElement('button');
autoScoreBtn.className = 'btn';
autoScoreBtn.textContent = '自动评分并生成评语';
autoScoreBtn.style.marginLeft = '10px';
document.getElementById('calculateScoreBtn').after(autoScoreBtn);

// 评语显示区域
const commentBox = document.createElement('div');
commentBox.className = 'calculation-result';
commentBox.style.marginTop = '15px';
commentBox.style.whiteSpace = 'pre-wrap';
document.querySelector('.score-section').appendChild(commentBox);

// 事件绑定
autoScoreBtn.onclick = () => {
    const sc = calcTotalScore();
    const com = generateComment(sc);
    commentBox.innerHTML =
        `<div style="color:${com.lvl.color};font-weight:bold">${com.text}</div>`;
};

/* ======================  自动评语/打分结束  ====================== */
    </script>
</body>
</html>