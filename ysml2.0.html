<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>杨氏模量测量实验报告</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4a6fa5;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        h2 {
            color: #4a6fa5;
            margin: 20px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eaeaea;
            font-size: 22px;
        }
        
        h3 {
            color: #6c7b95;
            margin: 15px 0 10px;
            font-size: 18px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
        }
        
        .info-label {
            font-weight: bold;
            min-width: 80px;
            color: #4a6fa5;
        }
        
        .info-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .experiment-content {
            margin-top: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9fafc;
            border-radius: 8px;
            border-left: 4px solid #4a6fa5;
        }
        
        .blank-question {
            margin: 12px 0;
            padding: 8px 0;
        }
        
        .blank-input {
            width: 180px;
            padding: 6px 10px;
            margin: 0 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
        }
        
        .blank-input:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: center;
        }
        
        .data-table th {
            background-color: #4a6fa5;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #4a6fa5;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a5a85;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
            transform: translateY(-2px);
        }
        
        .result-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f7ff;
            border-radius: 8px;
            border: 1px solid #cce0ff;
        }
        
        .result-title {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .comment-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff9e6;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        .comment-content {
            font-size: 16px;
            line-height: 1.8;
            min-height: 100px;
            padding: 15px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        
        .score-display {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
        }
        
        .score-label {
            color: #7f8c8d;
            font-size: 14px;
            text-align: center;
        }
        
        .summary-box {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 150px;
            font-family: inherit;
        }
        
        .summary-box:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        .preview-score-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
            text-align: center;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .correct {
            color: #27ae60;
            font-weight: bold;
        }
        
        .incorrect {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .parameter-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .param-group {
            display: flex;
            align-items: center;
        }
        
        .param-label {
            min-width: 100px;
            font-weight: bold;
            color: #4a6fa5;
        }
        
        .param-input {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .formula {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #4a6fa5;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            overflow-x: auto;
        }
        
        .calculation-note {
            background-color: #fff8e1;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            border-left: 3px solid #ffc107;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .parameter-inputs {
                flex-direction: column;
                gap: 10px;
            }
            
            .data-table {
                font-size: 14px;
            }
            
            .data-table th, .data-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>杨氏模量测量实验报告</h1>
        </header>
        
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">专业：</span>
                <input type="text" class="info-input" id="major" placeholder="请输入专业">
            </div>
            <div class="info-item">
                <span class="info-label">班级：</span>
                <input type="text" class="info-input" id="class" placeholder="请输入班级">
            </div>
            <div class="info-item">
                <span class="info-label">学号：</span>
                <input type="text" class="info-input" id="student-id" placeholder="请输入学号">
            </div>
            <div class="info-item">
                <span class="info-label">姓名：</span>
                <input type="text" class="info-input" id="name" placeholder="请输入姓名">
            </div>
            <div class="info-item">
                <span class="info-label">指导教师：</span>
                <input type="text" class="info-input" id="instructor" value="马厂" placeholder="请输入指导教师">
            </div>
            <div class="info-item">
                <span class="info-label">同组人：</span>
                <input type="text" class="info-input" id="partner" placeholder="请输入同组人">
            </div>
            <div class="info-item">
                <span class="info-label">实验时间：</span>
                <input type="text" class="info-input" id="experiment-time" placeholder="请输入实验时间">
            </div>
            <div class="info-item">
                <span class="info-label">实验地点：</span>
                <input type="text" class="info-input" id="location" placeholder="请输入实验地点">
            </div>
        </div>
        
        <div class="experiment-content">
            <h2>一、实验目的</h2>
            <div class="section">
                <div class="blank-question">
                    1. 掌握用 <input type="text" class="blank-input" id="blank1-1"> 和 <input type="text" class="blank-input" id="blank1-2"> 测量微小长度的原理和方法；
                </div>
                <div class="blank-question">
                    2. 测定金属丝的 <input type="text" class="blank-input" id="blank1-3">；
                </div>
                <div class="blank-question">
                    3. 学习用 <input type="text" class="blank-input" id="blank1-4"> 处理实验数据。
                </div>
            </div>
            
            <h2>二、实验仪器</h2>
            <div class="section">
                <div class="blank-question">
                    本实验采用卧式杨氏模量综合实验仪，它由 <input type="text" class="blank-input" id="blank2-1">、卧式杨氏模量测试架、测量仪和 <input type="text" class="blank-input" id="blank2-2"> 测量装置等部分组成。
                </div>
            </div>
            
            <h2>三、实验原理</h2>
            <div class="section">
                <p>本仪器是在拉伸法测量固体材料杨氏模量的基础上，加装位移传感器而成的。通过位移传感器的 <input type="text" class="blank-input" id="blank3-1"> 与位移量线性关系的定标和微小位移量的测量，实现金属丝杨氏模量的测定。</p>
                
                <p>有一段固体棒，在其两端沿轴方向施加大小相等、方向相反的外力 F，其长度 L 发生改变 ΔL，以 S 表示横截面面积，称 F/S 为 <input type="text" class="blank-input" id="blank3-2">，ΔL/L 为 <input type="text" class="blank-input" id="blank3-3">。</p>
                
                <p>在弹性限度内，根据胡克定律有：F/S = Y·ΔL/L</p>
                
                <p>式中，Y 称为杨氏模量，其数值与材料性质有关。若金属丝直径为 d，则：Y = 4FL/(πd²ΔL)</p>
                
                <p>式中，金属丝直径 d 可由 <input type="text" class="blank-input" id="blank3-4"> 测量，金属丝长度 L 可用米尺测量，外力 F 由 <input type="text" class="blank-input" id="blank3-5"> 测量。</p>
                
                <p>对于金属丝微小的形变量 ΔL 要测量准确，必须采用放大法。常用的放大法有位移传感器放大法和光杠杆放大法，本实验采用光杠杆放大法。</p>
                
                <h3>1. 位移传感器放大法</h3>
                <p>位移传感器是将霍尔元件置于磁感应强度大小为 B 的磁场中，在垂直于磁场方向通以电流 I，则与这二者相垂直的方向上将产生 <input type="text" class="blank-input" id="blank3-6"> U<sub>H</sub>。</p>
                
                <h3>2. 光杠杆放大法</h3>
                <p>激光光杠杆组附有三个尖足的 <input type="text" class="blank-input" id="blank3-7">。三个尖足的连线为一等腰三角形。上面两足尖与平面镜在同一平面内，下面足尖在上面两足尖的 <input type="text" class="blank-input" id="blank3-8"> 上。</p>
                
                <p>调好全部装置后，就会看到"<input type="text" class="blank-input" id="blank3-9">"激光经由光杠杆平面镜反射到 <input type="text" class="blank-input" id="blank3-10"> 上某一点。</p>
                
                <p>上式中，b 为 <input type="text" class="blank-input" id="blank3-11">（光杠下面足尖至上面两足尖连线的垂直距离）；D 为 <input type="text" class="blank-input" id="blank3-12"> 的距离。</p>
                
                <div class="formula">
                    <p><strong>杨氏模量计算公式（光杠杆法）：</strong></p>
                    <p>Y = 8LDF / (πd²bΔx)</p>
                    <p>其中：</p>
                    <ul>
                        <li>Y - 杨氏模量 (Pa)</li>
                        <li>L - 金属丝原长 (mm)</li>
                        <li>D - 光杠杆镜面至直尺距离 (mm)</li>
                        <li>F - 拉力 (N)</li>
                        <li>d - 金属丝直径 (mm)</li>
                        <li>b - 光杠杆常数 (mm)</li>
                        <li>Δx - 光杠杆放大后的位移变化 (mm)</li>
                    </ul>
                </div>
            </div>
            
            <h2>四、实验内容</h2>
            <div class="section">
                <h3>1. 光杠杆放大法测量金属丝的杨氏模量</h3>
                <div class="blank-question">
                    (1) 用直尺测量 D、b 和 L，用 <input type="text" class="blank-input" id="blank4-1"> 测量其直径 d。
                </div>
                <div class="blank-question">
                    (2) 逐渐增加 <input type="text" class="blank-input" id="blank4-2">，将拉力大小及"一字型"激光在游标卡尺上的位置 x 记录于表1。
                </div>
                <div class="blank-question">
                    (3) 用逐差法处理实验数据，求杨氏模量并计算误差。
                </div>
            </div>
            
            <h2>五、实验数据记录</h2>
            <div class="section">
                <div class="parameter-inputs">
                    <div class="param-group">
                        <span class="param-label">D (mm):</span>
                        <input type="number" class="param-input" id="param-D" value="1500" step="0.1">
                    </div>
                    <div class="param-group">
                        <span class="param-label">L (mm):</span>
                        <input type="number" class="param-input" id="param-L" value="800" step="0.1">
                    </div>
                    <div class="param-group">
                        <span class="param-label">b (mm):</span>
                        <input type="number" class="param-input" id="param-b" value="75" step="0.1">
                    </div>
                    <div class="param-group">
                        <span class="param-label">d (mm):</span>
                        <input type="number" class="param-input" id="param-d" value="0.5" step="0.01">
                    </div>
                </div>
                
                <h3>表1：光杠杆放大法测量金属丝杨氏模量数据</h3>
                <table class="data-table" id="data-table">
                    <thead>
                        <tr>
                            <th>次数</th>
                            <th>1</th>
                            <th>2</th>
                            <th>3</th>
                            <th>4</th>
                            <th>5</th>
                            <th>6</th>
                            <th>7</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>F (N)</td>
                            <td>0</td>
                            <td>4.9</td>
                            <td>9.8</td>
                            <td>14.7</td>
                            <td>19.6</td>
                            <td>24.5</td>
                            <td>29.4</td>
                        </tr>
                        <tr>
                            <td>x (mm)</td>
                            <td><input type="number" class="data-input" id="x1" value="0" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x2" value="0.32" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x3" value="0.64" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x4" value="0.97" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x5" value="1.29" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x6" value="1.62" step="0.01"></td>
                            <td><input type="number" class="data-input" id="x7" value="1.94" step="0.01"></td>
                        </tr>
                        <tr>
                            <td>Δx (mm)</td>
                            <td id="dx1">-</td>
                            <td id="dx2">-</td>
                            <td id="dx3">-</td>
                            <td id="dx4">-</td>
                            <td id="dx5">-</td>
                            <td id="dx6">-</td>
                            <td id="dx7">-</td>
                        </tr>
                        <tr>
                            <td>Y<sub>i</sub> (×10¹¹ Pa)</td>
                            <td id="Yi1">-</td>
                            <td id="Yi2">-</td>
                            <td id="Yi3">-</td>
                            <td id="Yi4">-</td>
                            <td id="Yi5">-</td>
                            <td id="Yi6">-</td>
                            <td id="Yi7">-</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="result-box">
                    <div class="result-title">
                        <span>杨氏模量计算结果</span>
                    </div>
                    <p>Y 的平均值: <span id="y-average">-</span> ×10¹¹ Pa</p>
                    <div class="calculation-note">
                        计算说明：按照Excel中的公式计算，Δx = |x_i - x₁|，Y_i = 8×L×D×F_i×1000000/(3.14×d²×b×Δx_i)
                    </div>
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn btn-primary" id="calculate-btn">计算数据并更新表格</button>
                <button class="btn btn-success" id="calculate-score-btn">计算预习分数</button>
                <button class="btn btn-warning" id="draw-chart-btn">绘制 F-x 关系图</button>
                <button class="btn btn-primary" id="auto-grade-btn">自动评分并生成评语</button>
            </div>
            
            <h2>六、图形绘制</h2>
            <div class="section">
                <div class="chart-container">
                    <canvas id="chart"></canvas>
                </div>
            </div>
            
            <h2>七、实验小结</h2>
            <div class="section">
                <textarea class="summary-box" id="summary" placeholder="请输入实验小结（包括实验目的、步骤、结果分析、心得体会等）..."></textarea>
            </div>
            
            <!-- 预习分数部分移动到实验小结之后 -->
            <h2>八、计算预习分数</h2>
            <div class="section preview-score-box">
                <div class="result-title">
                    <span>预习分数</span>
                </div>
                <div class="score-display" id="preview-score">0</div>
                <div class="score-label">预习分数（满分100分）</div>
                <p style="margin-top: 15px; color: #666; font-size: 14px;">
                    点击"计算预习分数"按钮，系统会根据填空题的正确率自动计算分数。
                </p>
            </div>
            
            <h2>九、自动评分并生成评语</h2>
            <div class="section comment-box">
                <div class="comment-header">
                    <div>
                        <strong>指导教师：</strong><span id="comment-instructor">马厂</span>
                    </div>
                    <div>
                        <strong>日期：</strong><span id="comment-date">-</span>
                    </div>
                </div>
                <div class="comment-content" id="comment-content">
                    请点击"自动评分并生成评语"按钮生成评语。
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <div class="score-display" id="final-score">0</div>
                    <div class="score-label">报告得分</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 定义正确答案
        const correctAnswers = {
            'blank1-1': '光杠杆',
            'blank1-2': '位移传感器',
            'blank1-3': '杨氏模量',
            'blank1-4': '逐差法',
            'blank2-1': '激光光杠杆',
            'blank2-2': '千分尺定标',
            'blank3-1': '输出电压',
            'blank3-2': '应力',
            'blank3-3': '应变',
            'blank3-4': '游标卡尺',
            'blank3-5': '数字拉力计',
            'blank3-6': '霍尔电势差',
            'blank3-7': '平面镜',
            'blank3-8': '中垂线',
            'blank3-9': '一字型',
            'blank3-10': '直尺',
            'blank3-11': '光杠杆常数',
            'blank3-12': '光杠杆镜面至直尺',
            'blank4-1': '游标卡尺',
            'blank4-2': '拉力'
        };
        
        // 初始化变量
        let chart = null;
        let previewScore = 0;
        let finalScore = 0;
        
        // DOM 加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 设置当前日期
            const now = new Date();
            const dateString = now.getFullYear() + '年' + (now.getMonth() + 1) + '月' + now.getDate() + '日';
            document.getElementById('comment-date').textContent = dateString;
            
            // 计算数据按钮事件
            document.getElementById('calculate-btn').addEventListener('click', calculateData);
            
            // 计算预习分数按钮事件
            document.getElementById('calculate-score-btn').addEventListener('click', calculatePreviewScore);
            
            // 绘制图表按钮事件
            document.getElementById('draw-chart-btn').addEventListener('click', drawChart);
            
            // 自动评分按钮事件
            document.getElementById('auto-grade-btn').addEventListener('click', autoGrade);
            
            // 更新评论中的指导教师
            document.getElementById('instructor').addEventListener('input', function() {
                document.getElementById('comment-instructor').textContent = this.value || '马厂';
            });
            
            // 初始计算数据
            calculateData();
        });
        
        // 计算实验数据 - 完全按照Excel中的公式计算
        function calculateData() {
            // 获取参数值
            const D = parseFloat(document.getElementById('param-D').value) || 1500;
            const L = parseFloat(document.getElementById('param-L').value) || 800;
            const b = parseFloat(document.getElementById('param-b').value) || 75;
            const d = parseFloat(document.getElementById('param-d').value) || 0.5;
            
            // 获取x值
            const xValues = [];
            for (let i = 1; i <= 7; i++) {
                const x = parseFloat(document.getElementById(`x${i}`).value) || 0;
                xValues.push(x);
            }
            
            // 计算Δx值（按照Excel公式：Δx = |x_i - x₁|）
            const dxValues = [];
            const x1 = xValues[0]; // 第一次测量的x值
            
            for (let i = 0; i < xValues.length; i++) {
                if (i === 0) {
                    dxValues.push(0);
                    document.getElementById(`dx${i+1}`).textContent = '0.000';
                } else {
                    const dx = Math.abs(xValues[i] - x1);
                    dxValues.push(dx);
                    document.getElementById(`dx${i+1}`).textContent = dx.toFixed(3);
                }
            }
            
            // 计算Yi值（按照Excel公式：Yi = 8*L*D*F_i*1000000/(3.14*d²*b*Δx_i)）
            const FValues = [0, 4.9, 9.8, 14.7, 19.6, 24.5, 29.4];
            const YiValues = [];
            let sumYi = 0;
            let countYi = 0;
            
            // 第1次（F=0）不计算
            document.getElementById('Yi1').textContent = '-';
            
            // 计算第2-7次的杨氏模量（共6个值）
            for (let i = 2; i <= 7; i++) {
                const F = FValues[i-1]; // F值的索引从0开始，第i次对应FValues[i-1]
                const dx = dxValues[i-1]; // dx值的索引从0开始
                
                // 按照Excel公式：Yi = 8*L*D*F*1000000/(3.14*d²*b*Δx)
                if (dx > 0 && F > 0) {
                    const numerator = 8 * L * D * F * 1000000;
                    const denominator = 3.14 * d * d * b * dx;
                    const Yi = numerator / denominator / 1e11; // 转换为×10¹¹ Pa单位
                    
                    YiValues.push(Yi);
                    sumYi += Yi;
                    countYi++;
                    document.getElementById(`Yi${i}`).textContent = Yi.toFixed(3);
                } else {
                    YiValues.push(0);
                    document.getElementById(`Yi${i}`).textContent = '-';
                }
            }
            
            // 计算Y的平均值（仅使用第2-7次的有效值）
            if (countYi > 0) {
                const avgYi = sumYi / countYi;
                document.getElementById('y-average').textContent = avgYi.toFixed(3);
            } else {
                document.getElementById('y-average').textContent = '-';
            }
            
            console.log(`计算完成：共计算${countYi}个有效杨氏模量值（第2-7次）`);
        }
        
        // 计算预习分数
        function calculatePreviewScore() {
            let score = 0;
            const totalBlanks = Object.keys(correctAnswers).length;
            
            // 检查每个填空
            for (const [id, correctAnswer] of Object.entries(correctAnswers)) {
                const inputElement = document.getElementById(id);
                if (inputElement) {
                    const userAnswer = inputElement.value.trim();
                    if (userAnswer === correctAnswer) {
                        score++;
                        inputElement.style.backgroundColor = '#e8f7ef';
                        inputElement.style.borderColor = '#27ae60';
                    } else if (userAnswer === '') {
                        inputElement.style.backgroundColor = '#fff';
                        inputElement.style.borderColor = '#ccc';
                    } else {
                        inputElement.style.backgroundColor = '#fdeaea';
                        inputElement.style.borderColor = '#e74c3c';
                    }
                }
            }
            
            // 计算分数（百分制）
            previewScore = Math.round((score / totalBlanks) * 100);
            document.getElementById('preview-score').textContent = previewScore;
            
            // 显示提示
            alert(`预习分数计算完成！\n正确填空数: ${score}/${totalBlanks}\n得分: ${previewScore}分`);
            
            return previewScore;
        }
        
        // 绘制图表 - 修正：F为横坐标，x为纵坐标
        function drawChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            
            // 获取x和F值
            const xValues = [];
            const FValues = [0, 4.9, 9.8, 14.7, 19.6, 24.5, 29.4];
            
            for (let i = 1; i <= 7; i++) {
                const x = parseFloat(document.getElementById(`x${i}`).value) || 0;
                xValues.push(x);
            }
            
            // 如果已有图表，销毁它
            if (chart) {
                chart.destroy();
            }
            
            // 创建新图表 - F为横坐标，x为纵坐标
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'F-x 关系数据点',
                        data: FValues.map((F, i) => ({x: F, y: xValues[i]})),
                        backgroundColor: 'rgba(74, 111, 165, 0.7)',
                        borderColor: 'rgba(74, 111, 165, 1)',
                        borderWidth: 1,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '拉力 F (N)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + ' N';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '位移 x (mm)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + ' mm';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `F=${context.parsed.x}N, x=${context.parsed.y.toFixed(2)}mm`;
                                }
                            }
                        }
                    }
                }
            });
            
            // 添加线性拟合
            addLinearFit(FValues, xValues);
        }
        
        // 添加线性拟合 - 修正：F为横坐标，x为纵坐标
        function addLinearFit(FValues, xValues) {
            // 计算线性回归（排除第一个点，因为F=0）
            const filteredF = FValues.slice(1);
            const filteredX = xValues.slice(1);
            const n = filteredF.length;
            
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += filteredF[i]; // X是F
                sumY += filteredX[i]; // Y是x
                sumXY += filteredF[i] * filteredX[i];
                sumX2 += filteredF[i] * filteredF[i];
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // 计算R²
            let ssRes = 0, ssTot = 0;
            const yMean = sumY / n;
            
            for (let i = 0; i < n; i++) {
                const yPred = slope * filteredF[i] + intercept;
                ssRes += Math.pow(filteredX[i] - yPred, 2);
                ssTot += Math.pow(filteredX[i] - yMean, 2);
            }
            
            const rSquared = 1 - (ssRes / ssTot);
            
            // 生成拟合线数据点
            const minX = Math.min(...filteredF);
            const maxX = Math.max(...filteredF);
            const fitX = [minX, maxX];
            const fitY = [slope * minX + intercept, slope * maxX + intercept];
            
            // 添加拟合线到图表
            chart.data.datasets.push({
                label: `线性拟合: x = ${slope.toFixed(3)}F + ${intercept.toFixed(3)} (R²=${rSquared.toFixed(4)})`,
                data: fitX.map((x, i) => ({x: x, y: fitY[i]})),
                backgroundColor: 'rgba(231, 76, 60, 0)',
                borderColor: 'rgba(231, 76, 60, 1)',
                borderWidth: 2,
                pointRadius: 0,
                type: 'line',
                fill: false
            });
            
            chart.update();
            
            // 显示拟合方程
            alert(`线性拟合方程: x = ${slope.toFixed(3)}F + ${intercept.toFixed(3)}\n决定系数 R² = ${rSquared.toFixed(4)}`);
        }
        
        // 自动评分并生成评语
        function autoGrade() {
            // 计算预习分数
            const previewScore = calculatePreviewScore();
            
            // 检查基本信息是否填写
            let basicInfoScore = 0;
            const basicInfoIds = ['major', 'class', 'student-id', 'name', 'experiment-time', 'location'];
            basicInfoIds.forEach(id => {
                if (document.getElementById(id).value.trim() !== '') {
                    basicInfoScore++;
                }
            });
            basicInfoScore = Math.round((basicInfoScore / basicInfoIds.length) * 10);
            
            // 检查实验小结
            const summary = document.getElementById('summary').value.trim();
            const summaryScore = summary.length > 100 ? 15 : Math.round(summary.length / 6.67);
            
            // 检查数据是否完整
            let dataScore = 0;
            for (let i = 1; i <= 7; i++) {
                const xValue = document.getElementById(`x${i}`).value;
                if (xValue !== '' && !isNaN(parseFloat(xValue))) {
                    dataScore++;
                }
            }
            dataScore = Math.round((dataScore / 7) * 20);
            
            // 检查杨氏模量计算
            const yAvg = document.getElementById('y-average').textContent;
            let calculationScore = 0;
            if (yAvg !== '-' && !isNaN(parseFloat(yAvg))) {
                const yValue = parseFloat(yAvg);
                // 合理范围检查（金属杨氏模量一般在0.5-2.5×10^11 Pa之间）
                if (yValue > 0.5 && yValue < 2.5) {
                    calculationScore = 25;
                } else if (yValue > 0.2 && yValue < 5.0) {
                    calculationScore = 20;
                } else {
                    calculationScore = 10;
                }
            }
            
            // 图表是否绘制
            const chartScore = chart ? 10 : 0;
            
            // 计算总分
            finalScore = previewScore * 0.2 + basicInfoScore + summaryScore + dataScore + calculationScore + chartScore;
            finalScore = Math.min(Math.round(finalScore), 100);
            
            // 显示总分
            document.getElementById('final-score').textContent = finalScore;
            
            // 生成评语
            generateComment(previewScore, basicInfoScore, summaryScore, dataScore, calculationScore, chartScore, finalScore);
        }
        
        // 生成评语
        function generateComment(previewScore, basicInfoScore, summaryScore, dataScore, calculationScore, chartScore, finalScore) {
            let comment = "";
            
            // 根据分数生成评语
            if (finalScore >= 90) {
                comment = "实验报告完成得非常出色！所有填空回答准确，数据记录完整，计算正确，图表绘制规范。实验小结深入，体现了对实验原理的深刻理解。";
            } else if (finalScore >= 80) {
                comment = "实验报告完成得较好。大部分填空回答正确，数据记录基本完整，计算基本准确。实验小结较为详细，但可以进一步深入分析实验现象。";
            } else if (finalScore >= 70) {
                comment = "实验报告基本完成。部分填空存在错误，数据记录较为完整，计算结果在合理范围内。实验小结内容较为简单，建议加强对实验原理的理解。";
            } else if (finalScore >= 60) {
                comment = "实验报告完成情况一般。存在较多填空错误，数据记录不够完整，计算结果可能存在偏差。实验小结过于简单，需要加强实验前的预习。";
            } else {
                comment = "实验报告完成情况不理想。大部分填空错误或未填写，数据记录不完整，计算结果存在问题。建议重新进行实验并认真撰写报告。";
            }
            
            // 添加具体反馈
            comment += "\n\n具体反馈：";
            
            if (previewScore < 60) {
                comment += "\n- 实验预习不足，建议在实验前认真阅读实验原理和步骤。";
            }
            
            if (basicInfoScore < 5) {
                comment += "\n- 基本信息填写不完整，请补充完整。";
            }
            
            if (summaryScore < 10) {
                comment += "\n- 实验小结过于简单，请详细描述实验过程、结果和分析。";
            }
            
            if (dataScore < 15) {
                comment += "\n- 实验数据记录不完整，请确保所有数据点都已记录。";
            }
            
            if (calculationScore < 15) {
                comment += "\n- 杨氏模量计算结果可能存在错误，请检查计算过程。";
            }
            
            if (chartScore === 0) {
                comment += "\n- 未绘制F-x关系图，请完成图表绘制部分。";
            }
            
            // 添加建议
            comment += "\n\n建议：";
            comment += "\n1. 实验前认真预习，理解实验原理；";
            comment += "\n2. 实验过程中认真记录数据，确保数据准确；";
            comment += "\n3. 使用逐差法处理数据时注意方法正确性；";
            comment += "\n4. 实验小结应包含实验目的、步骤、结果分析和心得体会。";
            
            // 显示评语
            document.getElementById('comment-content').textContent = comment;
            
            // 显示提示
            alert(`自动评分完成！\n报告得分: ${finalScore}分\n请查看下方评语。`);
        }
    </script>
</body>
</html>